<!doctype html><!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"><![endif]--><!--[if IE 7]><html class="no-js lt-ie9 lt-ie8"><![endif]--><!--[if IE 8]><html class="no-js lt-ie9"><![endif]--><!--[if gt IE 8]><!--><html class=no-js><!--<![endif]--><head><meta charset=utf-8><title>Deploying vRealize Automation 6.2 Appliance Cluster with Postgres Replication &#183; DefinIT</title><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=keywords content="appliance,Automation,cluster,load balancer,netscaler,replication,vRA,vRealize Automation,"><meta property="og:title" content="Deploying vRealize Automation 6.2 Appliance Cluster with Postgres Replication  &#183; DefinIT "><meta property="og:site_name" content="DefinIT"><meta property="og:url" content="https://www.definit.co.uk/2015/07/deploying-vrealize-automation-6-2-appliance-cluster-with-postgres-replication/"><meta property="og:locale" content="en-gb"><meta property="og:type" content="article"><meta property="og:description" content><meta property="og:article:published_time" content="2015-07-08T19:57:14Z"><meta property="og:article:modified_time" content="2015-07-08T19:57:14Z"><meta property="og:article:tag" content="appliance"><meta property="og:article:tag" content="Automation"><meta property="og:article:tag" content="cluster"><meta property="og:article:tag" content="load balancer"><meta property="og:article:tag" content="netscaler"><meta property="og:article:tag" content="replication"><meta property="og:article:tag" content="vRA"><meta property="og:article:tag" content="vRealize Automation"><meta name=twitter:card content="summary"><meta name=twitter:site content="@sammcgeown"><meta name=twitter:creator content="@sammcgeown"><meta name=twitter:title content="Deploying vRealize Automation 6.2 Appliance Cluster with Postgres Replication"><meta name=twitter:description content><meta name=twitter:url content="https://www.definit.co.uk/2015/07/deploying-vrealize-automation-6-2-appliance-cluster-with-postgres-replication/"><meta name=twitter:domain content="https://www.definit.co.uk"><link rel=canonical href=https://www.definit.co.uk/2015/07/deploying-vrealize-automation-6-2-appliance-cluster-with-postgres-replication/><link rel=apple-touch-icon-precomposed sizes=144x144 href=/touch-icon-144-precomposed.png><link rel=icon href=/images/favicon-16x16.png><meta name=generator content="Hugo 0.84.1"><!--[if lt IE 9]><script src=https://oss.maxcdn.com/libs/html5shiv/3.7.2/html5shiv.js></script><script src=https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js></script><![endif]--><script src=/js/clr-1.0/clr-icons.min.js></script><script src=/js/clr-1.0/custom-elements.min.js></script><link href=/css/clr-1.0/clr-ui-dark.css rel=stylesheet><link href=/css/clr-1.0/clr-icons.min.css rel=stylesheet><link href=/css/definit-clarity.css rel=stylesheet><link href=/css/lightbox.min.css rel=stylesheet></head><body data-ng-app=myapp data-ng-controller=MyController data-ng-mouseleave=MouseLeave($event)><div class=main-container><header class=header-6><div class=branding><a class=navbar-brand-img href=/><img alt src=/images/logos/definit-logo.png>
<span class=title>DefinIT</span></a></div><nav class=header-nav><a class="nav-link nav-text" href=https://www.definit.co.uk/>Home</a>
<a class="nav-link nav-text" href=https://www.definit.co.uk/about/>About</a>
<a class="nav-link nav-text" href=https://www.github.com/sammcgeown>GitHub</a>
<a class="nav-link nav-text" href=https://www.definit.co.uk/index.xml>RSS</a></nav><div class=header-actions><form class=search id=search method=get action=//google.com/search><label for=search_input><input id=search_input type=text name=q placeholder="Search with Google">
<input type=hidden name=as_sitesearch value=https://www.definit.co.uk></label></form></div></header><nav class=subnav><ul class=nav><li class=nav-item><a class=nav-link href=https://www.definit.co.uk/>Home</a></li><li class=nav-item><a class=nav-link href=https://www.definit.co.uk/about/>About</a></li><li class=nav-item><a class=nav-link href=https://www.github.com/sammcgeown>GitHub</a></li><li class=nav-item><a class=nav-link href=https://www.definit.co.uk/index.xml>RSS</a></li></ul></nav><div class=content-container><div class=content-area><h1>DEPLOYING VREALIZE AUTOMATION 6.2 APPLIANCE CLUSTER WITH POSTGRES REPLICATION</h1><div class=metas><span class=clr-card-authors><div class=clr-card-authors><img src=/images/SamMcGeown2020.jpg alt class=img-author>Written by <a href=https://www.definit.co.uk/authors/sam-mcgeown/>Sam McGeown</a>
on 8/7/2015
&#183; Read in about 8 min (1693 words)</div><div class=clr-card-authors>Published under <a href=/category/vmware>VMware</a> and <a href=/category/vrealize-automation>vRealize Automation</a></div><div class=clr-card-authors>Tags:
<a class=clr-tags href=https://www.definit.co.uk/tag/appliance>#appliance</a>
<a class=clr-tags href=https://www.definit.co.uk/tag/automation>#Automation</a>
<a class=clr-tags href=https://www.definit.co.uk/tag/cluster>#cluster</a>
<a class=clr-tags href=https://www.definit.co.uk/tag/load-balancer>#load balancer</a>
<a class=clr-tags href=https://www.definit.co.uk/tag/netscaler>#netscaler</a>
<a class=clr-tags href=https://www.definit.co.uk/tag/replication>#replication</a>
<a class=clr-tags href=https://www.definit.co.uk/tag/vra>#vRA</a>
<a class=clr-tags href=https://www.definit.co.uk/tag/vrealize-automation>#vRealize Automation</a></div></span></div><br clear=all><div class="alert alert-info" role=alert><div class=alert-items><div class="alert-item static"><div class=alert-icon-wrapper><clr-icon class=alert-icon shape=info-circle></clr-icon></div><span class=alert-text>This post is part of the <a href=https://www.definit.co.uk/series/vra-6.2-deployment/>vRA 6.2 Deployment</a> series.</span><div class=alert-actions><ol><li><a href=https://www.definit.co.uk/2015/08/deploying-fully-distributed-vrealize-automation-instance-configuring-netscaler-monitors/>Deploying fully distributed vRealize Automation instance – Configuring NetScaler Monitors</a></li><li><a href=https://www.definit.co.uk/2015/08/deploying-fully-distributed-vrealize-automation-iaas-components-part-2-database-web-and-manager-services/>Deploying fully distributed vRealize Automation IaaS components – Part 2: Database, Web and Manager services</a></li><li><a href=https://www.definit.co.uk/2015/08/deploying-fully-distributed-vrealize-automation-iaas-components-part-1-pre-requisites/>Deploying fully distributed vRealize Automation IaaS components – Part 1: Pre-requisites</a></li><li>Deploying vRealize Automation 6.2 Appliance Cluster with Postgres Replication</li><li><a href=https://www.definit.co.uk/2015/07/vsphere-6-ha-sso-psc-with-netscaler-vpx-load-balancer-for-vrealize-automation/>vSphere 6 HA SSO (PSC) with NetScaler VPX Load Balancer for vRealize Automation</a></li><li><a href=https://www.definit.co.uk/2014/09/vcac-6-06-1-build-out-to-distributed-model-deploy-the-identity-appliance/>vCAC 6.0/6.1 build out to distributed model: Deploy the Identity Appliance</a></li></ol></div></div></div></div><p><img style=float:right;display:inline src=http://blogs.vmware.com/management/files/2015/02/vRA-Product-Icon-Mac_0.png alt width=150 height=150 align=right>The recommendations for the vRealize Appliance have changed with 6.2, the published reference architecture now does not recommend using an external Postgres database (either vPostgres appliance, a 3rd party Postgres deployment or using a third vRealize Appliance as a stand-alone database installation). Instead the recommended layout is shown in the diagram below. One instance of postgres on the primary node becomes an active instance, replicating to the second node which is passive. In front of these a load balancer or DNS entry points to the active node only. Fail-over is still a manual task, but it does provide better protection than a single instance.</p><p>The cafe portal and APIs are still load balanced in an active/active configuration and are clustered together.</p><p><img src=https://www.definit.co.uk/images/2015/07/image_thumb49.png alt></p><h3 id=prerequisites>Prerequisites</h3><p>The following pre-requisites should be configured before deploying</p><h4 id=single-sign-on>Single Sign On</h4><p>As I discussed in my previous post, there are now three options for single sign on in vRealize Automation 6.2, the trusty old Identity Appliance, whose availability is based solely on vSphere HA. There is also vSphere 5.5 SSO and vSphere 6 Platform Services Controllers, which can both be clustered behind a load balancer to provide high availability.</p><p>For this deployment, I am using the <a href=http://vexpert.me/DW target=_blank>HA vSphere 6 Platform Services Controller</a> I created in my previous article.</p><h4 id=ip-addressing-and-dns-records>IP Addressing and DNS Records</h4><p>Four IP addresses and DNS records are required - one for each node, and one for each load balanced service. My DNS records are configured as below:</p><p><img src=https://www.definit.co.uk/images/2015/07/image_thumb50.png alt></p><h4 id=load-balancing>Load Balancing</h4><p>Load balancing vRealize Appliance web (HTTPS) and postgres traffic is a very simple affair and doesn&rsquo;t require a lot of advanced configuration - most load balancers will be fine. As I&rsquo;ve already deployed the NetScaler VPX Express for the HA PSC setup, I will continue using that.</p><p>Typically I prefer to use NSX Edge Gateways, however these are not supported for the PSC configuration.</p><h4 id=vrealize-appliance-ssl-certificate>vRealize Appliance SSL Certificate</h4><p>A certificate must be generated with with both appliance short names, FQDNs and IP addresses, as well as the short name, FQDN and IP address of the load balanced URL.</p><p>Create an openSSL cfg file (mine is saved as Z:\Certificates\vra-app\vra-app.cfg):</p><p><img src=https://www.definit.co.uk/images/2015/07/image_thumb51.png alt></p><p>Use the following as an example:</p><pre class="brush: bash; gutter: false">[ req ] 
default_bits = 2048 
default_keyfile = rui.key 
distinguished_name = req_distinguished_name 
encrypt_key = no 
prompt = no 
string_mask = nombstr 
req_extensions = v3_req 
[ v3_req ] 
basicConstraints = CA:FALSE 
keyUsage = digitalSignature, keyEncipherment, dataEncipherment, nonRepudiation 
extendedKeyUsage = serverAuth, clientAuth 
subjectAltName = DNS:cloud, IP:192.168.50.60, DNS:cloud.definit.local, DNS:vra-app-1, IP:192.168.50.61, DNS:vra-app-1.definit.local, DNS:vra-app-2, IP:192.168.50.62, DNS:vra-app-2.definit.local  
[ req_distinguished_name ] 
countryName = GB 
stateOrProvinceName = West Sussex 
localityName = Horsham 
0.organizationName = DefinIT 
organizationalUnitName = Lab 
commonName = cloud.definit.local</pre><p>Create a private key and certificate signing request using OpenSSL:</p><pre class="brush: text; gutter: false">openssl req -new -nodes -out Z:\Certificates\vra-app\rui.csr -keyout Z:\Certificates\vra-app\rui-orig.key -config Z:\Certificates\vra-app\vra-app.cfg</pre><p><img src=https://www.definit.co.uk/images/2015/07/image_thumb52.png alt></p><p>This creates a private key and csr file:</p><p><img src=https://www.definit.co.uk/images/2015/07/image_thumb53.png alt></p><p>Submit your request to your Certificate Authority using an advanced certificate request, copy the contents of the rui.csr file and paste it into the request form, selecting your VMware template.</p><p><img src=https://www.definit.co.uk/images/2015/07/image_thumb54.png alt></p><p>Download the base 64 encoded certificate and save it in the same folder as the key. Also download any root and subordinate CA certificates in the chain in base 64 format.</p><h3 id=configure-the-netscaler-load-balancer>Configure the NetScaler Load Balancer</h3><p>Log onto the NetScaler admin console and go to Configuration, Traffic Management, Load Balancing, Servers and click Add to enter the first vRA Appliance node’s IP. Repeat for the second node.</p><p><img src=https://www.definit.co.uk/images/2015/07/image_thumb55.png alt><img src=https://www.definit.co.uk/images/2015/07/image_thumb56.png alt></p><p>Go to Configuration, Traffic Management, Load Balancing, Services and click Add to configure a service on TCP port 5432, and SSL port 443 on each appliance node (they will show as down for now - that&rsquo;s fine)</p><p><img src=https://www.definit.co.uk/images/2015/07/image_thumb57.png alt> <img src=https://www.definit.co.uk/images/2015/07/image_thumb58.png alt> <img src=https://www.definit.co.uk/images/2015/07/image_thumb59.png alt> <img src=https://www.definit.co.uk/images/2015/07/image_thumb60.png alt></p><p>Go to Configuration, Traffic Management, Load Balancing, Virtual Servers and click Add to configure a virtual server for port 5432 on the load balanced IP for postrgres (configured earlier with the vra-db.definit.local DNS entry). Also create a virtual server on SSL port 443 on the load balanced IP</p><p><img src=https://www.definit.co.uk/images/2015/07/image_thumb61.png alt> <img src=https://www.definit.co.uk/images/2015/07/image_thumb62.png alt></p><p>For the SSL/443 virtual server, click “No Load Balancing Virtual Server Service Binding” and add the two relating services, with the default weight of 1.</p><p><img src=https://www.definit.co.uk/images/2015/07/image_thumb63.png alt></p><p>Click on &ldquo;No Server Certificate&rdquo; and add the SSL certificate (vra-app.cer) and private key (rui-orig.key) generated earlier, then click on &ldquo;No CA Certificate&rdquo; and add the CA certificates for the Appliances</p><p><img src=https://www.definit.co.uk/images/2015/07/image_thumb64.png alt></p><p> </p><p>On the right hand side, click on the &ldquo;Advanced&rdquo; option to add &ldquo;Persistence&rdquo; and then configure for SOURCEIP with a timeout of 30 minutes.</p><p><img src=https://www.definit.co.uk/images/2015/07/2015-07-14-19_59_38-Citrix-NetScaler-VPX-Configuration.png alt></p><p><img src=https://www.definit.co.uk/images/2015/07/2015-07-14-20_46_19-Citrix-NetScaler-VPX-Configuration-1024x314.png alt></p><p>For the TCP/5432 server, only add the first node (failover is manual). No certificates are required, and no persistence.</p><p><img src=https://www.definit.co.uk/images/2015/07/image_thumb65.png alt></p><h3 id=deploy-the-two-vrealize-appliance-nodes>Deploy the two vRealize Appliance nodes</h3><p>Deploy two appliances using the OVF deploy wizard, ensure you enable SSH on each node. I&rsquo;ve configured my nodes as below.</p><table border=1 width=600 cellspacing=0 cellpadding=2><tr><td valign=top width=200><strong>Property</strong></td><pre><code>&lt;td valign=&quot;top&quot; width=&quot;200&quot;&gt;
  &lt;strong&gt;Node 1 Value&lt;/strong&gt;
&lt;/td&gt;

&lt;td valign=&quot;top&quot; width=&quot;200&quot;&gt;
  &lt;strong&gt;Node 2 Value&lt;/strong&gt;
&lt;/td&gt;
</code></pre></tr><tr><td valign=top width=200>Name</td><pre><code>&lt;td valign=&quot;top&quot; width=&quot;200&quot;&gt;
  vra-app-1
&lt;/td&gt;

&lt;td valign=&quot;top&quot; width=&quot;200&quot;&gt;
  vra-app-2
&lt;/td&gt;
</code></pre></tr><tr><td valign=top width=200>IP Address</td><pre><code>&lt;td valign=&quot;top&quot; width=&quot;200&quot;&gt;
  192.168.50.61
&lt;/td&gt;

&lt;td valign=&quot;top&quot; width=&quot;200&quot;&gt;
  192.168.50.62
&lt;/td&gt;
</code></pre></tr><tr><td valign=top width=200>Subnet Mask</td><pre><code>&lt;td valign=&quot;top&quot; width=&quot;200&quot;&gt;
  255.255.255.0
&lt;/td&gt;

&lt;td valign=&quot;top&quot; width=&quot;200&quot;&gt;
  255.255.255.0
&lt;/td&gt;
</code></pre></tr><tr><td valign=top width=200>Gateway</td><pre><code>&lt;td valign=&quot;top&quot; width=&quot;200&quot;&gt;
  192.168.50.1
&lt;/td&gt;

&lt;td valign=&quot;top&quot; width=&quot;200&quot;&gt;
  192.168.50.1
&lt;/td&gt;
</code></pre></tr><tr><td valign=top width=200>DNS Name</td><pre><code>&lt;td valign=&quot;top&quot; width=&quot;200&quot;&gt;
  vra-app-1.definit.local
&lt;/td&gt;

&lt;td valign=&quot;top&quot; width=&quot;200&quot;&gt;
  vra-app-2.definit.local
&lt;/td&gt;
</code></pre></tr></table><p><img src=https://www.definit.co.uk/images/2015/07/image_thumb66.png alt> <img src=https://www.definit.co.uk/images/2015/07/image_thumb67.png alt></p><p><img src=https://www.definit.co.uk/images/2015/07/image_thumb68.png alt> <img src=https://www.definit.co.uk/images/2015/07/image_thumb69.png alt></p><p><img src=https://www.definit.co.uk/images/2015/07/image_thumb70.png alt> <img src=https://www.definit.co.uk/images/2015/07/image_thumb71.png alt></p><p><img src=https://www.definit.co.uk/images/2015/07/image_thumb72.png alt> <img src=https://www.definit.co.uk/images/2015/07/image_thumb73.png alt></p><p>Finish the wizard but do not power on the appliance after completion.</p><h3 id=configure-vrealize-appliance-nodes>Configure vRealize Appliance nodes</h3><p>Edit both vRealize Appliance virtual machines using the vSphere Web Client, and add a 20GB disk to each before powering them on:</p><p><img src=https://www.definit.co.uk/images/2015/07/image_thumb74.png alt></p><p>Download the scripts attached to <a href="http://kb.vmware.com/selfservice/microsites/search.do?language=en_US&cmd=displayKC&externalId=2108923#appendixB" target=_blank>KB2108923</a> and copy them to the /tmp folder on the first appliance using WinSCP or similar.</p><p>SSH to the first appliance node using PuTTY and move to the /tmp folder. Unzip the file:</p><pre class="brush: bash; gutter: false">unzip 2108923_dbCluster.zip</pre><p>This unzips a .tar file in the /tmp directory. Extract that using the tar commad:</p><pre class="brush: bash; gutter: false">tar xvf 2108923_dbCluster.tar</pre><p>There are now two scripts in the /tmp directory, configureDisk.sh and pgClusterSetup.sh</p><p><img src=https://www.definit.co.uk/images/2015/07/image_thumb75.png alt></p><p>Use the command &ldquo;parted -l&rdquo; to identify the unformatted disk - on a brand new vRA 6.2 appliance it should be /dev/sdd.</p><p><img src=https://www.definit.co.uk/images/2015/07/image_thumb76.png alt></p><p>Now configure the disk using the script extracted before:</p><pre class="brush: bash; gutter: false">/tmp/configureDisk.sh /dev/sdd</pre><p><img src=https://www.definit.co.uk/images/2015/07/image_thumb77.png alt></p><p>Now prepare the postgres instance for clustering using the second extracted script:</p><blockquote><p>pgClusterSetup.sh [-d] &lt;db_fqdn> [-w] &lt;db_pass> [-r] &lt;replication_password> [-p] &lt;postgres_password></p></blockquote><pre class="brush: bash; gutter: false">/tmp/pgClusterSetup.sh -d vra-db.definit.local -w dbP@ss -r repP@ss -p pgP@ss</pre><p>To use the same password for all three, just omit the -r and -p options - not a good idea for production, but OK to use in lab/testing.</p><p><img src=https://www.definit.co.uk/images/2015/07/image_thumb78.png alt></p><p>Repeat this process (add a disk, extract and run configureDisk.sh, then pgClusterSetup.sh) on the second appliance.</p><p>Now SSH to the second appliance and configure the second node to run as a replica of the first using the &ldquo;run_as_replica&rdquo; script.</p><blockquote><p>./run_as_replica –h <primary appliance>-b -W -U replicate</p></blockquote><blockquote><p>[-U] The user who will perform replication. For the purpose of this KB this user is replicate</p></blockquote><blockquote><p>[-W] Prompt for the password of the user performing replication</p></blockquote><blockquote><p>[-b] Take a base backup from the master. This option destroys the current contents of the data directory</p></blockquote><blockquote><p>[-h] Hostname of the master database server. Port 5432 is assumed</p></blockquote><p>Switch to the context of the &ldquo;postgres&rdquo; user</p><pre class="brush: bash; gutter: false">su – postgres
/opt/vmware/vpostgres/current/share/run_as_replica -h vra-app-1.definit.local -b -W -U replicate</pre><p> </p><p> </p><p><img src=https://www.definit.co.uk/images/2015/07/image_thumb80.png alt></p><p>Validate the replication on the nodes using the following:</p><p> </p><pre class="brush: bash; gutter: false">su - postgres
/opt/vmware/vpostgres/current/share/show_replication_status</pre><p>Primary:</p><p><img src=https://www.definit.co.uk/images/2015/07/image_thumb81.png alt></p><p>Secondary:</p><p><img src=https://www.definit.co.uk/images/2015/07/image_thumb82.png alt></p><p><a href="http://kb.vmware.com/selfservice/microsites/search.do?language=en_US&cmd=displayKC&externalId=2108923#appendixB" target=_blank>KB2108923</a> also has procedures for testing failover, which I strongly suggest doing before deploying in production.</p><h3 id=configure-the-primary-vrealize-appliance-node>Configure the primary vRealize Appliance node</h3><p>Open the vRealize Appliance administrative interface (<a href=https://vra-app-1.definit.local:5480>https://vra-app-1.definit.local:5480</a>) and log in using root and the password you specified during the deploy.</p><h4 id=configure-ntp-settings>Configure NTP settings</h4><p>Select the admin tab, then Time Settings, then select &ldquo;Use Time Server&rdquo; and specify the time servers. For a lab environment just using one is OK, but for production it&rsquo;s recommended to use 3-5. Click Save Settings to apply.</p><p><img src=https://www.definit.co.uk/images/2015/07/image_thumb83.png alt></p><h4 id=verify-database-settings>Verify Database Settings</h4><p>The database settings should have been updated to use the load balanced URL configured earlier, click on the vRA Settings tab, then Database to check:</p><p><img src=https://www.definit.co.uk/images/2015/07/image_thumb84.png alt></p><h4 id=install-ssl-certificates>Install SSL Certificates</h4><p>Return to the administrative interface on the first vRealize Appliance node, select vRA Settings and then Host Settings. Select &ldquo;Update Host&rdquo; and enter the load balancer FQDN under &ldquo;Host Name&rdquo;.</p><p>Select &ldquo;Import&rdquo; under SSL Configuration and paste the contents of &ldquo;rui-orig.key&rdquo; in the RSA Private Key field. Open the downloaded certificate in notepad and paste the contents into the &ldquo;Certificate Chain&rdquo; field. Immediately underneath, paste the next certificate in the chain. If you have an intermediate CA, paste that first, then the root CA.</p><p><img src=https://www.definit.co.uk/images/2015/07/image_thumb85.png alt></p><p>Click Save Settings to submit - both the host name and the SSL configuration should be updated with the FQDN of the load balancer.</p><p><img src=https://www.definit.co.uk/images/2015/07/image_thumb86.png alt></p><h4 id=configure-single-sign-on>Configure Single Sign On</h4><p><strong>Note</strong>: I am using the <a href=http://vexpert.me/DW target=_blank>HA Platform Services Controller</a> I created in my previous article.</p><p>Click on vRA Settings and then SSO and configure the FQDN of the load balancer URL for the HA PSC server. Change the SSO Port to 443 (7444 is correct vSphere 5.5 or Identity Appliance). Enter the SSO admin password. If you check the &ldquo;Apply branding&rdquo; box it will change the SSO sign on from &ldquo;VMware vCenter Single Sign-On&rdquo; to vRealize Automation Single Sign-On, so if it&rsquo;s a shared SSO platform you need to think about the implications for the users - they may get confused!</p><p><img src=https://www.definit.co.uk/images/2015/07/image_thumb87.png alt></p><p>Click Save Settings, and then (after quite a few minutes) SSO will be initialized.</p><p><img src=https://www.definit.co.uk/images/2015/07/image_thumb88.png alt></p><p>Click on &ldquo;Services&rdquo; tab and wait until all 23 services are initialized - you can monitor progress by SSHing to the first appliance and running &ldquo;tail -f /var/log/vcac/catalina.out&rdquo; to view progress. This can take 15-30 minutes - be patient!</p><p><img src=https://www.definit.co.uk/images/2015/07/image_thumb89.png alt></p><h3 id=add-the-second-vrealize-appliance-to-the-cluster>Add the second vRealize Appliance to the cluster</h3><p>Open the vRealize Appliance administrative interface on the second node (<a href=https://vra-app-2.definit.local:5480>https://vra-app-2.definit.local:5480</a>) and log in using root and the password you specified during the deploy.</p><h4 id=configure-ntp-settings-1>Configure NTP settings</h4><p>Select the admin tab, then Time Settings, then select &ldquo;Use Time Server&rdquo; and specify the time servers. For a lab environment just using one is OK, but for production it&rsquo;s recommended to use 3-5. Click Save Settings to apply.</p><p><img src=https://www.definit.co.uk/images/2015/07/image_thumb90.png alt></p><h4 id=configure-cluster>Configure Cluster</h4><p>Select the vRA Settings tab, Cluster and enter the name of the first node and the root password.</p><p><img src=https://www.definit.co.uk/images/2015/07/image_thumb91.png alt></p><p>Click &ldquo;Join Cluster&rdquo; and accept the certificate.</p><p><img src=https://www.definit.co.uk/images/2015/07/image_thumb92.png alt></p><p>It takes a few minutes, as with the first node, for all the services to initialize and get registered - however, no additional configuration is required on the second node, the add to cluster process configures everything required.</p><p><img src=https://www.definit.co.uk/images/2015/07/image_thumb93.png alt></p><h6>Share this post</h6><span class=share-box><a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.definit.co.uk%2f2015%2f07%2fdeploying-vrealize-automation-6-2-appliance-cluster-with-postgres-replication%2f" onclick="return window.open(this.href,'mywin','left=20,top=20,width=500,height=500,toolbar=1,resizable=0'),!1"><i class="fa fa-facebook-official"></i></a>
<a href="https://twitter.com/intent/tweet?text=Deploying%20vRealize%20Automation%206.2%20Appliance%20Cluster%20with%20Postgres%20Replication&url=https%3a%2f%2fwww.definit.co.uk%2f2015%2f07%2fdeploying-vrealize-automation-6-2-appliance-cluster-with-postgres-replication%2f" onclick="return window.open(this.href,'mywin','left=20,top=20,width=500,height=500,toolbar=1,resizable=0'),!1"><i class="fa fa-twitter"></i></a>
<a href="https://plus.google.com/share?url=https%3a%2f%2fwww.definit.co.uk%2f2015%2f07%2fdeploying-vrealize-automation-6-2-appliance-cluster-with-postgres-replication%2f" onclick="return window.open(this.href,'mywin','left=20,top=20,width=500,height=500,toolbar=1,resizable=0'),!1"><i class="fa fa-google-plus"></i></a>
<a href="http://www.reddit.com/submit?url=https%3a%2f%2fwww.definit.co.uk%2f2015%2f07%2fdeploying-vrealize-automation-6-2-appliance-cluster-with-postgres-replication%2f" onclick="return window.open(this.href,'mywin','left=20,top=20,width=900,height=500,toolbar=1,resizable=0'),!1"><i class="fa fa-reddit"></i></a>
<a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fwww.definit.co.uk%2f2015%2f07%2fdeploying-vrealize-automation-6-2-appliance-cluster-with-postgres-replication%2f&title=Deploying%20vRealize%20Automation%206.2%20Appliance%20Cluster%20with%20Postgres%20Replication" onclick="return window.open(this.href,'mywin','left=20,top=20,width=500,height=500,toolbar=1,resizable=0'),!1"><i class="fa fa-linkedin"></i></a>
<a href="mailto:?subject=Deploying%20vRealize%20Automation%206.2%20Appliance%20Cluster%20with%20Postgres%20Replication&body=Check out this site https%3a%2f%2fwww.definit.co.uk%2f2015%2f07%2fdeploying-vrealize-automation-6-2-appliance-cluster-with-postgres-replication%2f" data-proofer-ignore><i class="fa fa-envelope"></i></a></span>
<a class=resp-sharing-button__link href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.definit.co.uk%2f2015%2f07%2fdeploying-vrealize-automation-6-2-appliance-cluster-with-postgres-replication%2f" target=_blank rel=noopener aria-label><div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.77 7.46H14.5v-1.9c0-.9.6-1.1 1-1.1h3V.5h-4.33C10.24.5 9.5 3.44 9.5 5.32v2.15h-3v4h3v12h5v-12h3.85l.42-4z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://twitter.com/intent/tweet/?text=Deploying%20vRealize%20Automation%206.2%20Appliance%20Cluster%20with%20Postgres%20Replication&url=https%3a%2f%2fwww.definit.co.uk%2f2015%2f07%2fdeploying-vrealize-automation-6-2-appliance-cluster-with-postgres-replication%2f" target=_blank rel=noopener aria-label><div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M23.44 4.83c-.8.37-1.5.38-2.22.02.93-.56.98-.96 1.32-2.02-.88.52-1.86.9-2.9 1.1-.82-.88-2-1.43-3.3-1.43-2.5.0-4.55 2.04-4.55 4.54.0.36.03.7.1 1.04-3.77-.2-7.12-2-9.36-4.75-.4.67-.6 1.45-.6 2.3.0 1.56.8 2.95 2 3.77-.74-.03-1.44-.23-2.05-.57v.06c0 2.2 1.56 4.03 3.64 4.44-.67.2-1.37.2-2.06.08.58 1.8 2.26 3.12 4.25 3.16C5.78 18.1 3.37 18.74 1 18.46c2 1.3 4.4 2.04 6.97 2.04 8.35.0 12.92-6.92 12.92-12.93.0-.2.0-.4-.02-.6.9-.63 1.96-1.22 2.56-2.14z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://www.tumblr.com/widgets/share/tool?posttype=link&title=Deploying%20vRealize%20Automation%206.2%20Appliance%20Cluster%20with%20Postgres%20Replication&caption=Deploying%20vRealize%20Automation%206.2%20Appliance%20Cluster%20with%20Postgres%20Replication&content=https%3a%2f%2fwww.definit.co.uk%2f2015%2f07%2fdeploying-vrealize-automation-6-2-appliance-cluster-with-postgres-replication%2f&canonicalUrl=https%3a%2f%2fwww.definit.co.uk%2f2015%2f07%2fdeploying-vrealize-automation-6-2-appliance-cluster-with-postgres-replication%2f&shareSource=tumblr_share_button" target=_blank rel=noopener aria-label><div class="resp-sharing-button resp-sharing-button--tumblr resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13.5.5v5h5v4h-5V15c0 5 3.5 4.4 6 2.8v4.4c-6.7 3.2-12 0-12-4.2V9.5h-3V6.7c1-.3 2.2-.7 3-1.3.5-.5 1-1.2 1.4-2 .3-.7.6-1.7.7-3h3.8z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fwww.definit.co.uk%2f2015%2f07%2fdeploying-vrealize-automation-6-2-appliance-cluster-with-postgres-replication%2f&title=Deploying%20vRealize%20Automation%206.2%20Appliance%20Cluster%20with%20Postgres%20Replication&summary=Deploying%20vRealize%20Automation%206.2%20Appliance%20Cluster%20with%20Postgres%20Replication&source=https%3a%2f%2fwww.definit.co.uk%2f2015%2f07%2fdeploying-vrealize-automation-6-2-appliance-cluster-with-postgres-replication%2f" target=_blank rel=noopener aria-label><div class="resp-sharing-button resp-sharing-button--linkedin resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6.5 21.5h-5v-13h5v13zM4 6.5C2.5 6.5 1.5 5.3 1.5 4s1-2.4 2.5-2.4c1.6.0 2.5 1 2.6 2.5.0 1.4-1 2.5-2.6 2.5zm11.5 6c-1 0-2 1-2 2v7h-5v-13h5V10s1.6-1.5 4-1.5c3 0 5 2.2 5 6.3v6.7h-5v-7c0-1-1-2-2-2z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://reddit.com/submit/?url=https%3a%2f%2fwww.definit.co.uk%2f2015%2f07%2fdeploying-vrealize-automation-6-2-appliance-cluster-with-postgres-replication%2f&resubmit=true&title=Deploying%20vRealize%20Automation%206.2%20Appliance%20Cluster%20with%20Postgres%20Replication" target=_blank rel=noopener aria-label><div class="resp-sharing-button resp-sharing-button--reddit resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M24 11.5c0-1.65-1.35-3-3-3-.96.0-1.86.48-2.42 1.24-1.64-1-3.75-1.64-6.07-1.72.08-1.1.4-3.05 1.52-3.7.72-.4 1.73-.24 3 .5C17.2 6.3 18.46 7.5 20 7.5c1.65.0 3-1.35 3-3s-1.35-3-3-3c-1.38.0-2.54.94-2.88 2.22-1.43-.72-2.64-.8-3.6-.25-1.64.94-1.95 3.47-2 4.55-2.33.08-4.45.7-6.1 1.72C4.86 8.98 3.96 8.5 3 8.5c-1.65.0-3 1.35-3 3 0 1.32.84 2.44 2.05 2.84-.03.22-.05.44-.05.66.0 3.86 4.5 7 10 7s10-3.14 10-7c0-.22-.02-.44-.05-.66 1.2-.4 2.05-1.54 2.05-2.84zM2.3 13.37C1.5 13.07 1 12.35 1 11.5c0-1.1.9-2 2-2 .64.0 1.22.32 1.6.82-1.1.85-1.92 1.9-2.3 3.05zm3.7.13c0-1.1.9-2 2-2s2 .9 2 2-.9 2-2 2-2-.9-2-2zm9.8 4.8c-1.08.63-2.42.96-3.8.96-1.4.0-2.74-.34-3.8-.95-.24-.13-.32-.44-.2-.68.15-.24.46-.32.7-.18 1.83 1.06 4.76 1.06 6.6.0.23-.13.53-.05.67.2.14.23.06.54-.18.67zm.2-2.8c-1.1.0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm5.7-2.13c-.38-1.16-1.2-2.2-2.3-3.05.38-.5.97-.82 1.6-.82 1.1.0 2 .9 2 2 0 .84-.53 1.57-1.3 1.87z"/></svg></div></div></a><a class=resp-sharing-button__link href="mailto:?subject=Deploying%20vRealize%20Automation%206.2%20Appliance%20Cluster%20with%20Postgres%20Replication&body=https%3a%2f%2fwww.definit.co.uk%2f2015%2f07%2fdeploying-vrealize-automation-6-2-appliance-cluster-with-postgres-replication%2f" target=_self rel=noopener aria-label><div class="resp-sharing-button resp-sharing-button--email resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M22 4H2C.9 4 0 4.9.0 6v12c0 1.1.9 2 2 2h20c1.1.0 2-.9 2-2V6c0-1.1-.9-2-2-2zM7.25 14.43l-3.5 2c-.08.05-.17.07-.25.07-.17.0-.34-.1-.43-.25-.14-.24-.06-.55.18-.68l3.5-2c.24-.14.55-.06.68.18.14.24.06.55-.18.68zm4.75.07c-.1.0-.2-.03-.27-.08l-8.5-5.5c-.23-.15-.3-.46-.15-.7.15-.22.46-.3.7-.14L12 13.4l8.23-5.32c.23-.15.54-.08.7.15.14.23.07.54-.16.7l-8.5 5.5c-.08.04-.17.07-.27.07zm8.93 1.75c-.1.16-.26.25-.43.25-.08.0-.17-.02-.25-.07l-3.5-2c-.24-.13-.32-.44-.18-.68s.44-.32.68-.18l3.5 2c.24.13.32.44.18.68z"/></svg></div></div></a><a class=resp-sharing-button__link href="whatsapp://send?text=Deploying%20vRealize%20Automation%206.2%20Appliance%20Cluster%20with%20Postgres%20Replication%20https%3a%2f%2fwww.definit.co.uk%2f2015%2f07%2fdeploying-vrealize-automation-6-2-appliance-cluster-with-postgres-replication%2f" target=_blank rel=noopener aria-label><div class="resp-sharing-button resp-sharing-button--whatsapp resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.1 3.9C17.9 1.7 15 .5 12 .5 5.8.5.7 5.6.7 11.9c0 2 .5 3.9 1.5 5.6L.6 23.4l6-1.6c1.6.9 3.5 1.3 5.4 1.3 6.3.0 11.4-5.1 11.4-11.4-.1-2.8-1.2-5.7-3.3-7.8zM12 21.4c-1.7.0-3.3-.5-4.8-1.3l-.4-.2-3.5 1 1-3.4L4 17c-1-1.5-1.4-3.2-1.4-5.1.0-5.2 4.2-9.4 9.4-9.4 2.5.0 4.9 1 6.7 2.8s2.8 4.2 2.8 6.7c-.1 5.2-4.3 9.4-9.5 9.4zm5.1-7.1c-.3-.1-1.7-.9-1.9-1-.3-.1-.5-.1-.7.1-.2.3-.8 1-.9 1.1-.2.2-.3.2-.6.1s-1.2-.5-2.3-1.4c-.9-.8-1.4-1.7-1.6-2s0-.5.1-.6.3-.3.4-.5c.2-.1.3-.3.4-.5s0-.4.0-.5C10 9 9.3 7.6 9 7c-.1-.4-.4-.3-.5-.3h-.6s-.4.1-.7.3c-.3.3-1 1-1 2.4s1 2.8 1.1 3c.1.2 2 3.1 4.9 4.3.7.3 1.2.5 1.6.6.7.2 1.3.2 1.8.1.6-.1 1.7-.7 1.9-1.3.2-.7.2-1.2.2-1.3-.1-.3-.3-.4-.6-.5z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://telegram.me/share/url?text=Deploying%20vRealize%20Automation%206.2%20Appliance%20Cluster%20with%20Postgres%20Replication&url=https%3a%2f%2fwww.definit.co.uk%2f2015%2f07%2fdeploying-vrealize-automation-6-2-appliance-cluster-with-postgres-replication%2f" target=_blank rel=noopener aria-label><div class="resp-sharing-button resp-sharing-button--telegram resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M.707 8.475C.275 8.64.0 9.508.0 9.508s.284.867.718 1.03l5.09 1.897 1.986 6.38a1.102 1.102.0 001.75.527l2.96-2.41a.405.405.0 01.494-.013l5.34 3.87a1.1 1.1.0 001.046.135 1.1 1.1.0 00.682-.803l3.91-18.795A1.102 1.102.0 0022.5.075L.706 8.475z"/></svg></div></div></a><div id=disqus_thread></div><script type=text/javascript>(function(){if(window.location.hostname=="localhost")return;var a=document.createElement('script');a.async=!0,a.type='text/javascript',a.src='//definit.disqus.com/embed.js',(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(a)})()</script><noscript>Please enable JavaScript to view the <a href=http://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><div class="clarity-prev-next col-xs-12 col-sm-12 col-md-12 col-lg-12"><nav class=clarity-page-prev-next><div class=clr-nav-previous><a href=https://www.definit.co.uk/2015/07/vsphere-6-ha-sso-psc-with-netscaler-vpx-load-balancer-for-vrealize-automation/ title="vSphere 6 HA SSO (PSC) with NetScaler VPX Load Balancer for vRealize Automation" class="btn btn-sm btn-outline">Previous</a></div><div class=clr-nav-next><a href=https://www.definit.co.uk/2015/07/resetting-the-vsphere-6-platform-services-controller-root-password/ title="Resetting the vSphere 6 vCenter Server Appliance or Platform Services Controller root password" class="btn btn-sm btn-outline">Next</a></div></nav></div></div><div class=content-area></div><nav class="sidenav clr-col-12 clr-col-sm-12 clr-col-md-12 clr-col-lg-6 clr-col-xl-6"><section class=sidenav-content><section class="nav-group collapsible"><input id=Categories type=checkbox>
<label for=Categories>Categories</label><ul class=nav-list><li><a href=/category/automation class=nav-link>AUTOMATION <span class="badge badge-1">7</span></a></li><li><a href=/category/career class=nav-link>CAREER <span class="badge badge-1">22</span></a></li><li><a href=/category/certification class=nav-link>CERTIFICATION <span class="badge badge-1">2</span></a></li><li><a href=/category/cloud class=nav-link>CLOUD <span class="badge badge-1">8</span></a></li><li><a href=/category/cloud-native class=nav-link>CLOUD-NATIVE <span class="badge badge-1">13</span></a></li><li><a href=/category/community class=nav-link>COMMUNITY <span class="badge badge-1">41</span></a></li><li><a href=/category/development class=nav-link>DEVELOPMENT <span class="badge badge-1">3</span></a></li><li><a href=/category/log-insight class=nav-link>LOG-INSIGHT <span class="badge badge-1">2</span></a></li><li><a href=/category/microsoft class=nav-link>MICROSOFT <span class="badge badge-1">60</span></a></li><li><a href=/category/networking class=nav-link>NETWORKING <span class="badge badge-1">34</span></a></li><li><a href=/category/nsx class=nav-link>NSX <span class="badge badge-1">26</span></a></li><li><a href=/category/powercli class=nav-link>POWERCLI <span class="badge badge-1">4</span></a></li><li><a href=/category/storage class=nav-link>STORAGE <span class="badge badge-1">6</span></a></li><li><a href=/category/vcf class=nav-link>VCF <span class="badge badge-1">1</span></a></li><li><a href=/category/vcloud-director class=nav-link>VCLOUD-DIRECTOR <span class="badge badge-1">5</span></a></li><li><a href=/category/vmware class=nav-link>VMWARE <span class="badge badge-1">204</span></a></li><li><a href=/category/vmware-cloud-foundation class=nav-link>VMWARE-CLOUD-FOUNDATION <span class="badge badge-1">1</span></a></li><li><a href=/category/vmworld class=nav-link>VMWORLD <span class="badge badge-1">12</span></a></li><li><a href=/category/vrealize-automation class=nav-link>VREALIZE-AUTOMATION <span class="badge badge-1">43</span></a></li><li><a href=/category/vrealize-operations class=nav-link>VREALIZE-OPERATIONS <span class="badge badge-1">72</span></a></li><li><a href=/category/vrealize-orchestrator class=nav-link>VREALIZE-ORCHESTRATOR <span class="badge badge-1">28</span></a></li><li><a href=/category/vsan class=nav-link>VSAN <span class="badge badge-1">4</span></a></li><li><a href=/category/vsphere class=nav-link>VSPHERE <span class="badge badge-1">56</span></a></li><li><a href=/category/webinar class=nav-link>WEBINAR <span class="badge badge-1">17</span></a></li></ul></section><section class="nav-group collapsible"><input id=Tags type=checkbox>
<label for=Tags>Tags (Top 10)</label><ul class=nav-list><li><a href=/tag/vrops class=nav-link>VROPS <span class="badge badge-1">68</span></a></li><li><a href=/tag/vmware class=nav-link>VMWARE <span class="badge badge-1">51</span></a></li><li><a href=/tag/windows class=nav-link>WINDOWS <span class="badge badge-1">38</span></a></li><li><a href=/tag/automation class=nav-link>AUTOMATION <span class="badge badge-1">35</span></a></li><li><a href=/tag/esx-and-esxi class=nav-link>ESX-AND-ESXI <span class="badge badge-1">33</span></a></li><li><a href=/tag/vcenter-server class=nav-link>VCENTER-SERVER <span class="badge badge-1">33</span></a></li><li><a href=/tag/nsx class=nav-link>NSX <span class="badge badge-1">31</span></a></li><li><a href=/tag/vmworld class=nav-link>VMWORLD <span class="badge badge-1">30</span></a></li><li><a href=/tag/vra class=nav-link>VRA <span class="badge badge-1">28</span></a></li><li><a href=/tag/webinar class=nav-link>WEBINAR <span class="badge badge-1">26</span></a></li></section><section class=nav-group><label for=Sponsors>Sponsors</label><ul class=nav-list></ul></section></section></nav></div><script async src="https://www.googletagmanager.com/gtag/js?id=UA-4368767-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','UA-4368767-1')</script><script src=/js/lightbox-plus-jquery.min.js></script></div></body></html>