<!doctype html><!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"><![endif]--><!--[if IE 7]><html class="no-js lt-ie9 lt-ie8"><![endif]--><!--[if IE 8]><html class="no-js lt-ie9"><![endif]--><!--[if gt IE 8]><!--><html class=no-js><!--<![endif]--><head><meta charset=utf-8><title>vSphere 6 HA SSO (PSC) with NetScaler VPX Load Balancer for vRealize Automation &#183; DefinIT</title><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=keywords content="Automation,Networking,ha,load balancer,netscaler,Platform Services Controller (PSC),psc,vCenter Server,vRA,vsphere,"><meta property="og:title" content="vSphere 6 HA SSO (PSC) with NetScaler VPX Load Balancer for vRealize Automation  &#183; DefinIT "><meta property="og:site_name" content="DefinIT"><meta property="og:url" content="https://www.definit.co.uk/2015/07/vsphere-6-ha-sso-psc-with-netscaler-vpx-load-balancer-for-vrealize-automation/"><meta property="og:locale" content="en-gb"><meta property="og:type" content="article"><meta property="og:description" content><meta property="og:article:published_time" content="2015-07-07T15:40:21Z"><meta property="og:article:modified_time" content="2015-07-07T15:40:21Z"><meta property="og:article:tag" content="Automation"><meta property="og:article:tag" content="Networking"><meta property="og:article:tag" content="ha"><meta property="og:article:tag" content="load balancer"><meta property="og:article:tag" content="netscaler"><meta property="og:article:tag" content="Platform Services Controller (PSC)"><meta property="og:article:tag" content="psc"><meta property="og:article:tag" content="vCenter Server"><meta property="og:article:tag" content="vRA"><meta property="og:article:tag" content="vsphere"><meta name=twitter:card content="summary"><meta name=twitter:site content="@sammcgeown"><meta name=twitter:creator content="@sammcgeown"><meta name=twitter:title content="vSphere 6 HA SSO (PSC) with NetScaler VPX Load Balancer for vRealize Automation"><meta name=twitter:description content><meta name=twitter:url content="https://www.definit.co.uk/2015/07/vsphere-6-ha-sso-psc-with-netscaler-vpx-load-balancer-for-vrealize-automation/"><meta name=twitter:domain content="https://www.definit.co.uk"><link rel=canonical href=https://www.definit.co.uk/2015/07/vsphere-6-ha-sso-psc-with-netscaler-vpx-load-balancer-for-vrealize-automation/><link rel=apple-touch-icon-precomposed sizes=144x144 href=/touch-icon-144-precomposed.png><link rel=icon href=/images/favicon-16x16.png><meta name=generator content="Hugo 0.103.1"><!--[if lt IE 9]><script src=https://oss.maxcdn.com/libs/html5shiv/3.7.2/html5shiv.js></script>
<script src=https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js></script><![endif]--><script src=/js/clr-icons.min.js></script>
<script src=/js/custom-elements.min.js></script>
<link href=/css/clr-ui.min.css rel=stylesheet><link href=/css/clr-icons.min.css rel=stylesheet><link href=/css/definit-clarity.css rel=stylesheet><link href=/css/lightbox.min.css rel=stylesheet></head><body data-ng-app=myapp data-ng-controller=MyController data-ng-mouseleave=MouseLeave($event)><div class=main-container><header class=header-6><div class=branding><a class=navbar-brand-img href=/><img alt src=/images/logos/definit-logo.png>
<span class=title>DefinIT</span></a></div><nav class=header-nav><a class="nav-link nav-text" href=https://www.definit.co.uk/ title=Home>Home</a>
<a class="nav-link nav-text" href=https://www.definit.co.uk/about/ title=About>About</a>
<a class="nav-link nav-text" href=https://www.github.com/sammcgeown title=GitHub>GitHub</a>
<a class="nav-link nav-text" href=https://www.definit.co.uk/index.xml title=RSS>RSS</a></nav><div class=header-actions><form class=search id=search method=get action=//google.com/search><label for=search_input><input id=search_input type=text name=q placeholder="Search with Google">
<input type=hidden name=as_sitesearch value=https://www.definit.co.uk></label></form></div></header><div class=content-container><div class=content-area><h1>vSphere 6 HA SSO (PSC) with NetScaler VPX Load Balancer for vRealize Automation</h1><div class=metas><span class=clr-card-authors><div class=clr-card-authors><img src=/images/SamMcGeown2020.jpg alt class=img-author>Written by <a href=https://www.definit.co.uk/authors/sam-mcgeown/>Sam McGeown</a>
on 7/7/2015
&#183; Read in about 8 min (1497 words)</div><div class=clr-card-authors>Published under <a href=/category/vmware>VMware</a> and <a href=/category/vrealize-automation>vRealize Automation</a></div><div class=clr-card-authors>Tags:
<a class=clr-tags href=https://www.definit.co.uk/tag/automation>#Automation</a>
<a class=clr-tags href=https://www.definit.co.uk/tag/networking>#Networking</a>
<a class=clr-tags href=https://www.definit.co.uk/tag/ha>#ha</a>
<a class=clr-tags href=https://www.definit.co.uk/tag/load-balancer>#load balancer</a>
<a class=clr-tags href=https://www.definit.co.uk/tag/netscaler>#netscaler</a>
<a class=clr-tags href=https://www.definit.co.uk/tag/platform-services-controller-psc>#Platform Services Controller (PSC)</a>
<a class=clr-tags href=https://www.definit.co.uk/tag/psc>#psc</a>
<a class=clr-tags href=https://www.definit.co.uk/tag/vcenter-server>#vCenter Server</a>
<a class=clr-tags href=https://www.definit.co.uk/tag/vra>#vRA</a>
<a class=clr-tags href=https://www.definit.co.uk/tag/vsphere>#vsphere</a></div></span></div><br clear=all><div class="alert alert-info" role=alert><div class=alert-items><div class="alert-item static"><div class=alert-icon-wrapper><clr-icon class=alert-icon shape=info-circle></clr-icon></div><span class=alert-text>This post is part of the <a href=https://www.definit.co.uk/series/vra-6.2-deployment/>vRA 6.2 Deployment</a> series.</span><div class=alert-actions><ol><li><a href=https://www.definit.co.uk/2015/08/deploying-fully-distributed-vrealize-automation-instance-configuring-netscaler-monitors/>Deploying fully distributed vRealize Automation instance – Configuring NetScaler Monitors</a></li><li><a href=https://www.definit.co.uk/2015/08/deploying-fully-distributed-vrealize-automation-iaas-components-part-2-database-web-and-manager-services/>Deploying fully distributed vRealize Automation IaaS components – Part 2: Database, Web and Manager services</a></li><li><a href=https://www.definit.co.uk/2015/08/deploying-fully-distributed-vrealize-automation-iaas-components-part-1-pre-requisites/>Deploying fully distributed vRealize Automation IaaS components – Part 1: Pre-requisites</a></li><li><a href=https://www.definit.co.uk/2015/07/deploying-vrealize-automation-6-2-appliance-cluster-with-postgres-replication/>Deploying vRealize Automation 6.2 Appliance Cluster with Postgres Replication</a></li><li>vSphere 6 HA SSO (PSC) with NetScaler VPX Load Balancer for vRealize Automation</li><li><a href=https://www.definit.co.uk/2014/09/vcac-6-06-1-build-out-to-distributed-model-deploy-the-identity-appliance/>vCAC 6.0/6.1 build out to distributed model: Deploy the Identity Appliance</a></li></ol></div></div></div></div><div class="alert alert-danger" role=alert><div class=alert-items><div class="alert-item static"><div class=alert-icon-wrapper><clr-icon class=alert-icon shape=warning-standard></clr-icon></div><span class=alert-text>This article is now 7 years old! It is highly likely that this information is out of date and the author will have completely forgotten about it. Please take care when following any guidance to ensure you have up-to-date recommendations.</span></div></div></div><div class=multi_part_posts><ol><li><strong>vSphere 6 HA SSO (PSC) with NetScaler VPX Load Balancer for vRealize Automation</strong></li><li><a href=https://www.definit.co.uk/2015/07/deploying-vrealize-automation-6-2-appliance-cluster-with-postgres-replication/ title="Deploying vRealize Automation 6.2 Appliance Cluster with Postgres Replication">Deploying vRealize Automation 6.2 Appliance Cluster with Postgres Replication</a></li><li><a href=https://www.definit.co.uk/2015/08/deploying-fully-distributed-vrealize-automation-iaas-components-part-1-pre-requisites/ title="Deploying fully distributed vRealize Automation IaaS components - Part 1: Pre-requisites">Deploying fully distributed vRealize Automation IaaS components - Part 1: Pre-requisites</a></li><li><a href=https://www.definit.co.uk/2015/08/deploying-fully-distributed-vrealize-automation-iaas-components-part-2-database-web-and-manager-services/ title="Deploying fully distributed vRealize Automation IaaS components - Part 2: Database, Web and Manager services">Deploying fully distributed vRealize Automation IaaS components - Part 2: Database, Web and Manager services</a></li><li><a href=https://www.definit.co.uk/2015/08/deploying-fully-distributed-vrealize-automation-instance-configuring-netscaler-monitors/ title="Deploying fully distributed vRealize Automation instance - Configuring NetScaler Monitors">Deploying fully distributed vRealize Automation instance - Configuring NetScaler Monitors</a></li></ol></div><p><img class="alignright size-full wp-image-6055" src=/images/2015/07/download.png alt=vCenter width=95 height=96>Providing a highly available single sign on for vRealize Automation is a fundamental part of ensuring the availability of the platform. Traditionally, (vCAC) vRA uses the Identity Appliance and relies on vSphere HA to provide the availability of the SSO platform, but in a fully distributed HA environment that&rsquo;s not really good enough. It&rsquo;s also possible to use the vSphere 5.5 SSO install in a HA configuration - however, many companies are making the move to the latest version of vSphere and don&rsquo;t necessarily want to maintain a 5.5 HA SSO instance.</p><p>The vSphere 6 Platform Services Controller can be deployed as an appliance or installed on a Windows host - personally I am a huge fan of the appliances and I tend to use them in my designs because of the simplicity and ease of use. A pair of PSCs can be deployed as a highly available SSO solution for vRealize Automation 6.2, replacing the Identity Appliance or vSphere 5.5. SSO, using either a NetScaler or F5 load balancer to load balance connections and provide the availability.</p><p>Personally, I&rsquo;d prefer to use an NSX Edge Services Gateway to load balance the PSCs, but at the time of writing the Edge does not support the &ldquo;Ability to have session affinity to the same PSC node across all configured ports&rdquo;. See <a href="http://kb.vmware.com/selfservice/search.do?cmd=displayKC&docType=kc&docTypeID=DT_KB_1_1&externalId=2112736" target=_blank>KB2112736</a> for more details.</p><p>So, this guide will show you how to create a highly available pair of Platform Service Controllers, configure one as a subordinate Certificate Authority to a Microsoft Certificate Services CA, and then load balance them with a NetScaler VPX. Although I am using just two node, you can in fact use the same method to load balance up to four.</p><h3 id=pre-requisites>Pre-requisites <a class=anchor href=#pre-requisites><i class="fas fa-hashtag"></i></a></h3><p>Firstly, we need to ensure some of the pre-requisites are completed.</p><h4 id=create-dns-a-and-ptr-records>Create DNS A and PTR records <a class=anchor href=#create-dns-a-and-ptr-records><i class="fas fa-hashtag"></i></a></h4><p>An A and PTR (forward and reverse) DNS record needs to be created for each PSC and the load balancer address.</p><p><img src=https://www.definit.co.uk/images/2015/07/image_thumb18.png alt></p><h4 id=configure-distributed-port-group>Configure Distributed Port Group <a class=anchor href=#configure-distributed-port-group><i class="fas fa-hashtag"></i></a></h4><p>Ensure that the target Distributed Port Group&rsquo;s port binding is set to Ephemeral. This is a requirement for the vSphere 6 vCenter Server Appliance deploy because it&rsquo;s pushing the appliance to an ESXi host not a vCenter Server. Once the appliances have been deployed they can be migrated to a non-Ephemeral port group.</p><p><img src=https://www.definit.co.uk/images/2015/07/image_thumb19.png alt></p><h3 id=deploy-the-first-psc-node>Deploy the first PSC Node <a class=anchor href=#deploy-the-first-psc-node><i class="fas fa-hashtag"></i></a></h3><p>Run the vCenter Server Appliance installer (vcsa-setup.html on the ISO), at this point you might need to install the Client Integration Plugin. Click Install.</p><p><img src=https://www.definit.co.uk/images/2015/07/image_thumb20.png alt></p><p>Accept the EULA and configure the target ESXi host</p><p><img src=https://www.definit.co.uk/images/2015/07/image9_thumb.png alt> <img src=https://www.definit.co.uk/images/2015/07/image15_thumb.png alt></p><p>Accept any SSL warning and then configure the appliance name and root password. Select the PSC install type.</p><p><img src=https://www.definit.co.uk/images/2015/07/image_thumb21.png alt> <img src=https://www.definit.co.uk/images/2015/07/image21_thumb.png alt></p><p>Configure the new SSO domain. The PSC is 2 CPU and 2GB of RAM with 30GB disk</p><p><strong>Note</strong>: <em>For vRealize Automation it must use the default domain &ldquo;vsphere.local&rdquo; and site name &ldquo;Default-First-Site&rdquo;.</em></p><p><img src=https://www.definit.co.uk/images/2015/07/image24_thumb.png alt> <img src=https://www.definit.co.uk/images/2015/07/image27_thumb.png alt></p><p>Select the target storage and configure the networking.</p><p><img src=https://www.definit.co.uk/images/2015/07/image30_thumb.png alt></p><p><strong>Note</strong>: <em>As I mentioned earlier, only Ephemeral port groups are visible here.</em></p><p><img src=https://www.definit.co.uk/images/2015/07/image_thumb22.png alt></p><p>Configure NTP - NTP is critical for vRA deployments, and enable SSH because we&rsquo;ll need it later to configure the PSC HA.</p><p><img src=https://www.definit.co.uk/images/2015/07/image_thumb23.png alt></p><p>Review and deploy the node:</p><p><img src=https://www.definit.co.uk/images/2015/07/image_thumb24.png alt></p><h3 id=deploy-the-second-psc-node>Deploy the second PSC Node <a class=anchor href=#deploy-the-second-psc-node><i class="fas fa-hashtag"></i></a></h3><p>The second PSC node is identical to the first, save the name (I&rsquo;m using vra-psc-2) and the SSO configuration. Instead of creating a new domain, we join the second node to the SSO for the first node, and select the previously created site:</p><p><img src=https://www.definit.co.uk/images/2015/07/image_thumb25.png alt> <img src=https://www.definit.co.uk/images/2015/07/image45_thumb.png alt></p><p>And complete the wizard</p><h3 id=configure-the-vmca-as-a-subordinate-ca>Configure the VMCA as a Subordinate CA <a class=anchor href=#configure-the-vmca-as-a-subordinate-ca><i class="fas fa-hashtag"></i></a></h3><p>I use <a href=http://www.derekseaman.com/2015/04/vsphere-6-0-install-pt-11-vmca-as-subordinate.html target=_blank>Derek Seaman&rsquo;s instructions</a>, and <a href=http://vexpert.me/toolkit60 target=_blank>awesome toolkit</a> to help generate SSL certificates for vSphere. Follow the process carefully to create a VMCA certificate for <strong>both</strong> PSCs.</p><p><img src=https://www.definit.co.uk/images/2015/07/image_thumb26.png alt></p><p>The certificates are generated in a folder called VMCA, under the folder configured in the script for output. Copy the output to a separate folder before generating the second CA certificate. <strong>To be clear, you need a VMCA certificate generated for each PSC node, using the PSC node&rsquo;s FQDN, not the load balanced FQDN.</strong></p><p>Here&rsquo;s my two:</p><p><img src=https://www.definit.co.uk/images/2015/07/image_thumb27.png alt></p><h4 id=install-and-configure-the-vmca-certificates>Install and configure the VMCA certificates <a class=anchor href=#install-and-configure-the-vmca-certificates><i class="fas fa-hashtag"></i></a></h4><p>Upload and install the certificates using the instructions in Derek&rsquo;s article - I&rsquo;ve uploaded the two required files to /root/ssl</p><p><img src=https://www.definit.co.uk/images/2015/07/image_thumb28.png alt></p><p>Run the certificate-manager script to replace the &ldquo;VMCA root certificate with custom signing certificate and replace all certificates&rdquo;</p><pre class="brush: shell; gutter: true">/usr/lib/vmware-vmca/bin/certificate-manager</pre><p><img src=https://www.definit.co.uk/images/2015/07/image_thumb29.png alt></p><p>Configure the certificate configuration, ensuring that the &ldquo;hostname&rdquo; field is the FQDN of the PSC node:</p><p><img src=https://www.definit.co.uk/images/2015/07/image_thumb30.png alt></p><p>Once the install is completed, restart the appliance, or restart all the vCenter Services using &lsquo;service-control -stop -all&rsquo; and &lsquo;service-control -start -all&rsquo;.</p><p>Repeat on the 2nd PSC node using the certificates generated for it.</p><h3 id=configure-psc-with-ha-scripts>Configure PSC with HA Scripts <a class=anchor href=#configure-psc-with-ha-scripts><i class="fas fa-hashtag"></i></a></h3><p>Download the <a href="https://my.vmware.com/group/vmware/details?downloadGroup=PSCHA600&productId=489" target=_blank>HA scripts from VMware</a> and copy them to the /tmp directory on the first PSC node. How you copy the zip file up to the appliances is up to you</p><p><em>If you find SCP problematic with the different shells, it&rsquo;s possible to temporarily mount an NFS share to copy in/out and copied the file from there - e.g:</em></p><p> </p><pre class="brush: bash; gutter: false">mount 192.168.1.97:/nfs/Temp /tmp/nfs -o nolock
cp /tmp/nfs/VMware-psc-ha-6.0.0.2503195.zip /tmp</pre><p>However, if you&rsquo;ve enabled bash as the default shell for the root user, just copy them up using WinSCP.</p><p>Once the scripts are on the appliance, create a /ha directory &ldquo;mkdir /ha&rdquo; then unzip the scripts to the /ha directory:</p><pre class="brush: bash; gutter: false">unzip VMware-psc-ha-6.0.0.2503195.zip -d /ha/</pre><p>Still on the first PSC node, run the gen-lb-cert.py script using the FQDN of your load balancer:</p><pre class="brush: bash; gutter: false">python gen-lb-cert.py --primary-node --lb-fqdn=vra-psc.definit.local</pre><p><img src=https://www.definit.co.uk/images/2015/07/image_thumb31.png alt></p><p>Copy the /etc/vmware-sso/keys folder to /ha/keys</p><pre class="brush: bash; gutter: false">cp -r /etc/vmware-sso/keys /ha</pre><p>The /ha folder now looks something like this:</p><p><img src=https://www.definit.co.uk/images/2015/07/image_thumb32.png alt></p><p>Copy the contents of the /ha folder over to the second node&rsquo;s /ha folder. How you achieve this is up to you, WinSCP or a shared NFS mount work for me. It&rsquo;s important to ensure that the &ldquo;keys&rdquo; folder is copied across, with the contents of /etc/vmware-sso/keys.</p><h3 id=configure-certificates-on-the-second-psc-node>Configure certificates on the second PSC node <a class=anchor href=#configure-certificates-on-the-second-psc-node><i class="fas fa-hashtag"></i></a></h3><p>Log onto the second PSC node as root and run the following:</p><pre class="brush: bash; gutter: false">python gen-lb-cert.py --secondary-node --lb-fqdn=vra-psc.definit.local --lb-cert-folder=/ha --sso-serversign-folder=/ha/keys</pre><p><img src=https://www.definit.co.uk/images/2015/07/image_thumb33.png alt></p><h3 id=configure-netscaler-vpx-load-balancer>Configure NetScaler VPX Load Balancer <a class=anchor href=#configure-netscaler-vpx-load-balancer><i class="fas fa-hashtag"></i></a></h3><p>Let me just caveat this with &ldquo;I am a NetScaler newbie&rdquo; - this worked for me but if you&rsquo;re a guru, you may know better!</p><p>Ensure that you have SSL Offloading enabled before you start - System, Settings, Configure Basic Features. Failing to do so will mean your Virtual Server for port 443 won&rsquo;t come up until you do - you&rsquo;ll see in my screenshots below that I didn&rsquo;t have it enabled, but by the magic of blogging I&rsquo;ll make it look good and tell you here!</p><p><img src=https://www.definit.co.uk/images/2015/07/image_thumb34.png alt></p><h4 id=configure-certificate-trusts>Configure Certificate Trusts <a class=anchor href=#configure-certificate-trusts><i class="fas fa-hashtag"></i></a></h4><p>Download from the /ha folder the following files: lb.crt, lb_rsa.key and root.cer.</p><p>Click on Configuration, Traffic Management, SSL, Certificates, then click Install.</p><p>Add the lb.crt and lb_rsa.key files and click Install.</p><p><img src=https://www.definit.co.uk/images/2015/07/image_thumb35.png alt></p><h4 id=configure-server-nodes>Configure Server Nodes <a class=anchor href=#configure-server-nodes><i class="fas fa-hashtag"></i></a></h4><p>Go to Configuration, Traffic Management, Load Balancing, Servers and click Add to enter the first PSC node&rsquo;s IP.</p><p><img src=https://www.definit.co.uk/images/2015/07/image_thumb36.png alt></p><p>Add both nodes:</p><p><img src=https://www.definit.co.uk/images/2015/07/image_thumb37.png alt></p><h4 id=configure-services>Configure Services <a class=anchor href=#configure-services><i class="fas fa-hashtag"></i></a></h4><p>Go to Configuration, Traffic Management, Load Balancing, Services and click Add</p><p><img src=https://www.definit.co.uk/images/2015/07/image_thumb38.png alt></p><p>Create a Service for ports 443 (SSL_TCP), 389, 636, 2012, 2014 and 2020 (TCP) for each of the nodes:</p><p><img src=https://www.definit.co.uk/images/2015/07/image_thumb39.png alt></p><h4 id=configure-virtual-servers>Configure Virtual Servers <a class=anchor href=#configure-virtual-servers><i class="fas fa-hashtag"></i></a></h4><p>Go to Configuration, Traffic Management, Load Balancing, Virtual Servers and click Add</p><h4 id=httpswwwdefinitcoukimages201507image_thumb40png><img src=https://www.definit.co.uk/images/2015/07/image_thumb40.png alt> <a class=anchor href=#httpswwwdefinitcoukimages201507image_thumb40png><i class="fas fa-hashtag"></i></a></h4><p>If you&rsquo;re prompted, enable load balancing:</p><p><img src=https://www.definit.co.uk/images/2015/07/image_thumb41.png alt></p><p>You&rsquo;re presented with a summary of the Virtual Server:</p><p><img src=https://www.definit.co.uk/images/2015/07/image_thumb42.png alt></p><p>Click &ldquo;No Load Balancing Virtual Server Service Binding&rdquo; and add the two relating services, the first node with weight 1 and the second with weight 10:</p><p><img src=https://www.definit.co.uk/images/2015/07/image_thumb43.png alt></p><p>Click &ldquo;No Server Certificate&rdquo; and bind the PSC certificate we added earlier:</p><p><img src=https://www.definit.co.uk/images/2015/07/image_thumb44.png alt></p><p>Once again, create a Virtual Server for each of the ports and bind the relevant Services (node 1 with weight 1, node 2 with weight 10) to each Virtual Server. Port 443 is the only one that requires the Server Certificate Binding.</p><p><img src=https://www.definit.co.uk/images/2015/07/image_thumb45.png alt></p><h4 id=create-persistency-groups>Create Persistency Groups <a class=anchor href=#create-persistency-groups><i class="fas fa-hashtag"></i></a></h4><p>Go to Configuration, Traffic Management, Load Balancing, Persistency Groups and click Add</p><p>Configure the group name (VRA-PSC), set persistence to SOURCEIP, time-out to 1440 and add all the VRA-PSC-VIP Virtual Servers:</p><p><img src=https://www.definit.co.uk/images/2015/07/image_thumb46.png alt></p><h3 id=update-the-psc-endpoint-url>Update the PSC endpoint URL <a class=anchor href=#update-the-psc-endpoint-url><i class="fas fa-hashtag"></i></a></h3><p>Finally, the last step is to update the endpoint URL back on the first PSC node using the lstoolHA.py script.</p><pre class="brush: bash; gutter: false">python lstoolHA.py --hostname=vra-psc-1.definit.local --lb-fqdn=vra-psc.definit.local --lb-cert-folder=/ha --user=administrator@vsphere.local --password=SSOPassword</pre><p>There&rsquo;s a lot of output after that command, but once it&rsquo;s completed the HA SSO should be complete.</p><p>We can verify the PSC endpoint is updated correctly using the following commands (if you followed this guide to set it up for vRA, the site name will be &ldquo;default-first-site&rdquo;):</p><pre class="brush: bash; gutter: false">python /usr/lib/vmidentity/tools/scripts/lstool.py list --url http://localhost/lookupservice/sdk --site default-first-site --type cs.license | grep "URL:"</pre><p>Check that the URL outputs are updated to the load balanced URL:</p><p><img src=https://www.definit.co.uk/images/2015/07/image_thumb47.png alt></p><pre class="brush: bash; gutter: false">python /usr/lib/vmidentity/tools/scripts/lstool.py list --url http://localhost/lookupservice/sdk --site default-first-site --type cs.identity | grep "URL:"</pre><p> </p><p><img src=https://www.definit.co.uk/images/2015/07/image_thumb48.png alt></p><p> </p><p>I hope that this has been useful to you, a monster post at nearly 1500 words!</p><p> </p><h6>Share this post</h6><span class=share-box><a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.definit.co.uk%2f2015%2f07%2fvsphere-6-ha-sso-psc-with-netscaler-vpx-load-balancer-for-vrealize-automation%2f" onclick='return window.open(this.href,"mywin","left=20,top=20,width=500,height=500,toolbar=1,resizable=0"),!1'><i class="fa fa-facebook-official"></i></a>
<a href="https://twitter.com/intent/tweet?text=vSphere%206%20HA%20SSO%20%28PSC%29%20with%20NetScaler%20VPX%20Load%20Balancer%20for%20vRealize%20Automation&url=https%3a%2f%2fwww.definit.co.uk%2f2015%2f07%2fvsphere-6-ha-sso-psc-with-netscaler-vpx-load-balancer-for-vrealize-automation%2f" onclick='return window.open(this.href,"mywin","left=20,top=20,width=500,height=500,toolbar=1,resizable=0"),!1'><i class="fa fa-twitter"></i></a>
<a href="https://plus.google.com/share?url=https%3a%2f%2fwww.definit.co.uk%2f2015%2f07%2fvsphere-6-ha-sso-psc-with-netscaler-vpx-load-balancer-for-vrealize-automation%2f" onclick='return window.open(this.href,"mywin","left=20,top=20,width=500,height=500,toolbar=1,resizable=0"),!1'><i class="fa fa-google-plus"></i></a>
<a href="http://www.reddit.com/submit?url=https%3a%2f%2fwww.definit.co.uk%2f2015%2f07%2fvsphere-6-ha-sso-psc-with-netscaler-vpx-load-balancer-for-vrealize-automation%2f" onclick='return window.open(this.href,"mywin","left=20,top=20,width=900,height=500,toolbar=1,resizable=0"),!1'><i class="fa fa-reddit"></i></a>
<a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fwww.definit.co.uk%2f2015%2f07%2fvsphere-6-ha-sso-psc-with-netscaler-vpx-load-balancer-for-vrealize-automation%2f&title=vSphere%206%20HA%20SSO%20%28PSC%29%20with%20NetScaler%20VPX%20Load%20Balancer%20for%20vRealize%20Automation" onclick='return window.open(this.href,"mywin","left=20,top=20,width=500,height=500,toolbar=1,resizable=0"),!1'><i class="fa fa-linkedin"></i></a>
<a href="mailto:?subject=vSphere%206%20HA%20SSO%20%28PSC%29%20with%20NetScaler%20VPX%20Load%20Balancer%20for%20vRealize%20Automation&body=Check out this site https%3a%2f%2fwww.definit.co.uk%2f2015%2f07%2fvsphere-6-ha-sso-psc-with-netscaler-vpx-load-balancer-for-vrealize-automation%2f" data-proofer-ignore><i class="fa fa-envelope"></i></a></span>
<a class=resp-sharing-button__link href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.definit.co.uk%2f2015%2f07%2fvsphere-6-ha-sso-psc-with-netscaler-vpx-load-balancer-for-vrealize-automation%2f" target=_blank rel=noopener aria-label><div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.77 7.46H14.5v-1.9c0-.9.6-1.1 1-1.1h3V.5h-4.33C10.24.5 9.5 3.44 9.5 5.32v2.15h-3v4h3v12h5v-12h3.85l.42-4z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://twitter.com/intent/tweet/?text=vSphere%206%20HA%20SSO%20%28PSC%29%20with%20NetScaler%20VPX%20Load%20Balancer%20for%20vRealize%20Automation&url=https%3a%2f%2fwww.definit.co.uk%2f2015%2f07%2fvsphere-6-ha-sso-psc-with-netscaler-vpx-load-balancer-for-vrealize-automation%2f" target=_blank rel=noopener aria-label><div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M23.44 4.83c-.8.37-1.5.38-2.22.02.93-.56.98-.96 1.32-2.02-.88.52-1.86.9-2.9 1.1-.82-.88-2-1.43-3.3-1.43-2.5.0-4.55 2.04-4.55 4.54.0.36.03.7.1 1.04-3.77-.2-7.12-2-9.36-4.75-.4.67-.6 1.45-.6 2.3.0 1.56.8 2.95 2 3.77-.74-.03-1.44-.23-2.05-.57v.06c0 2.2 1.56 4.03 3.64 4.44-.67.2-1.37.2-2.06.08.58 1.8 2.26 3.12 4.25 3.16C5.78 18.1 3.37 18.74 1 18.46c2 1.3 4.4 2.04 6.97 2.04 8.35.0 12.92-6.92 12.92-12.93.0-.2.0-.4-.02-.6.9-.63 1.96-1.22 2.56-2.14z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://www.tumblr.com/widgets/share/tool?posttype=link&title=vSphere%206%20HA%20SSO%20%28PSC%29%20with%20NetScaler%20VPX%20Load%20Balancer%20for%20vRealize%20Automation&caption=vSphere%206%20HA%20SSO%20%28PSC%29%20with%20NetScaler%20VPX%20Load%20Balancer%20for%20vRealize%20Automation&content=https%3a%2f%2fwww.definit.co.uk%2f2015%2f07%2fvsphere-6-ha-sso-psc-with-netscaler-vpx-load-balancer-for-vrealize-automation%2f&canonicalUrl=https%3a%2f%2fwww.definit.co.uk%2f2015%2f07%2fvsphere-6-ha-sso-psc-with-netscaler-vpx-load-balancer-for-vrealize-automation%2f&shareSource=tumblr_share_button" target=_blank rel=noopener aria-label><div class="resp-sharing-button resp-sharing-button--tumblr resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13.5.5v5h5v4h-5V15c0 5 3.5 4.4 6 2.8v4.4c-6.7 3.2-12 0-12-4.2V9.5h-3V6.7c1-.3 2.2-.7 3-1.3.5-.5 1-1.2 1.4-2 .3-.7.6-1.7.7-3h3.8z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fwww.definit.co.uk%2f2015%2f07%2fvsphere-6-ha-sso-psc-with-netscaler-vpx-load-balancer-for-vrealize-automation%2f&title=vSphere%206%20HA%20SSO%20%28PSC%29%20with%20NetScaler%20VPX%20Load%20Balancer%20for%20vRealize%20Automation&summary=vSphere%206%20HA%20SSO%20%28PSC%29%20with%20NetScaler%20VPX%20Load%20Balancer%20for%20vRealize%20Automation&source=https%3a%2f%2fwww.definit.co.uk%2f2015%2f07%2fvsphere-6-ha-sso-psc-with-netscaler-vpx-load-balancer-for-vrealize-automation%2f" target=_blank rel=noopener aria-label><div class="resp-sharing-button resp-sharing-button--linkedin resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6.5 21.5h-5v-13h5v13zM4 6.5C2.5 6.5 1.5 5.3 1.5 4s1-2.4 2.5-2.4c1.6.0 2.5 1 2.6 2.5.0 1.4-1 2.5-2.6 2.5zm11.5 6c-1 0-2 1-2 2v7h-5v-13h5V10s1.6-1.5 4-1.5c3 0 5 2.2 5 6.3v6.7h-5v-7c0-1-1-2-2-2z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://reddit.com/submit/?url=https%3a%2f%2fwww.definit.co.uk%2f2015%2f07%2fvsphere-6-ha-sso-psc-with-netscaler-vpx-load-balancer-for-vrealize-automation%2f&resubmit=true&title=vSphere%206%20HA%20SSO%20%28PSC%29%20with%20NetScaler%20VPX%20Load%20Balancer%20for%20vRealize%20Automation" target=_blank rel=noopener aria-label><div class="resp-sharing-button resp-sharing-button--reddit resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M24 11.5c0-1.65-1.35-3-3-3-.96.0-1.86.48-2.42 1.24-1.64-1-3.75-1.64-6.07-1.72.08-1.1.4-3.05 1.52-3.7.72-.4 1.73-.24 3 .5C17.2 6.3 18.46 7.5 20 7.5c1.65.0 3-1.35 3-3s-1.35-3-3-3c-1.38.0-2.54.94-2.88 2.22-1.43-.72-2.64-.8-3.6-.25-1.64.94-1.95 3.47-2 4.55-2.33.08-4.45.7-6.1 1.72C4.86 8.98 3.96 8.5 3 8.5c-1.65.0-3 1.35-3 3 0 1.32.84 2.44 2.05 2.84-.03.22-.05.44-.05.66.0 3.86 4.5 7 10 7s10-3.14 10-7c0-.22-.02-.44-.05-.66 1.2-.4 2.05-1.54 2.05-2.84zM2.3 13.37C1.5 13.07 1 12.35 1 11.5c0-1.1.9-2 2-2 .64.0 1.22.32 1.6.82-1.1.85-1.92 1.9-2.3 3.05zm3.7.13c0-1.1.9-2 2-2s2 .9 2 2-.9 2-2 2-2-.9-2-2zm9.8 4.8c-1.08.63-2.42.96-3.8.96-1.4.0-2.74-.34-3.8-.95-.24-.13-.32-.44-.2-.68.15-.24.46-.32.7-.18 1.83 1.06 4.76 1.06 6.6.0.23-.13.53-.05.67.2.14.23.06.54-.18.67zm.2-2.8c-1.1.0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm5.7-2.13c-.38-1.16-1.2-2.2-2.3-3.05.38-.5.97-.82 1.6-.82 1.1.0 2 .9 2 2 0 .84-.53 1.57-1.3 1.87z"/></svg></div></div></a><a class=resp-sharing-button__link href="mailto:?subject=vSphere%206%20HA%20SSO%20%28PSC%29%20with%20NetScaler%20VPX%20Load%20Balancer%20for%20vRealize%20Automation&body=https%3a%2f%2fwww.definit.co.uk%2f2015%2f07%2fvsphere-6-ha-sso-psc-with-netscaler-vpx-load-balancer-for-vrealize-automation%2f" target=_self rel=noopener aria-label><div class="resp-sharing-button resp-sharing-button--email resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M22 4H2C.9 4 0 4.9.0 6v12c0 1.1.9 2 2 2h20c1.1.0 2-.9 2-2V6c0-1.1-.9-2-2-2zM7.25 14.43l-3.5 2c-.08.05-.17.07-.25.07-.17.0-.34-.1-.43-.25-.14-.24-.06-.55.18-.68l3.5-2c.24-.14.55-.06.68.18.14.24.06.55-.18.68zm4.75.07c-.1.0-.2-.03-.27-.08l-8.5-5.5c-.23-.15-.3-.46-.15-.7.15-.22.46-.3.7-.14L12 13.4l8.23-5.32c.23-.15.54-.08.7.15.14.23.07.54-.16.7l-8.5 5.5c-.08.04-.17.07-.27.07zm8.93 1.75c-.1.16-.26.25-.43.25-.08.0-.17-.02-.25-.07l-3.5-2c-.24-.13-.32-.44-.18-.68s.44-.32.68-.18l3.5 2c.24.13.32.44.18.68z"/></svg></div></div></a><a class=resp-sharing-button__link href="whatsapp://send?text=vSphere%206%20HA%20SSO%20%28PSC%29%20with%20NetScaler%20VPX%20Load%20Balancer%20for%20vRealize%20Automation%20https%3a%2f%2fwww.definit.co.uk%2f2015%2f07%2fvsphere-6-ha-sso-psc-with-netscaler-vpx-load-balancer-for-vrealize-automation%2f" target=_blank rel=noopener aria-label><div class="resp-sharing-button resp-sharing-button--whatsapp resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.1 3.9C17.9 1.7 15 .5 12 .5 5.8.5.7 5.6.7 11.9c0 2 .5 3.9 1.5 5.6L.6 23.4l6-1.6c1.6.9 3.5 1.3 5.4 1.3 6.3.0 11.4-5.1 11.4-11.4-.1-2.8-1.2-5.7-3.3-7.8zM12 21.4c-1.7.0-3.3-.5-4.8-1.3l-.4-.2-3.5 1 1-3.4L4 17c-1-1.5-1.4-3.2-1.4-5.1.0-5.2 4.2-9.4 9.4-9.4 2.5.0 4.9 1 6.7 2.8s2.8 4.2 2.8 6.7c-.1 5.2-4.3 9.4-9.5 9.4zm5.1-7.1c-.3-.1-1.7-.9-1.9-1-.3-.1-.5-.1-.7.1-.2.3-.8 1-.9 1.1-.2.2-.3.2-.6.1s-1.2-.5-2.3-1.4c-.9-.8-1.4-1.7-1.6-2s0-.5.1-.6.3-.3.4-.5c.2-.1.3-.3.4-.5s0-.4.0-.5C10 9 9.3 7.6 9 7c-.1-.4-.4-.3-.5-.3h-.6s-.4.1-.7.3c-.3.3-1 1-1 2.4s1 2.8 1.1 3c.1.2 2 3.1 4.9 4.3.7.3 1.2.5 1.6.6.7.2 1.3.2 1.8.1.6-.1 1.7-.7 1.9-1.3.2-.7.2-1.2.2-1.3-.1-.3-.3-.4-.6-.5z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://telegram.me/share/url?text=vSphere%206%20HA%20SSO%20%28PSC%29%20with%20NetScaler%20VPX%20Load%20Balancer%20for%20vRealize%20Automation&url=https%3a%2f%2fwww.definit.co.uk%2f2015%2f07%2fvsphere-6-ha-sso-psc-with-netscaler-vpx-load-balancer-for-vrealize-automation%2f" target=_blank rel=noopener aria-label><div class="resp-sharing-button resp-sharing-button--telegram resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M.707 8.475C.275 8.64.0 9.508.0 9.508s.284.867.718 1.03l5.09 1.897 1.986 6.38a1.102 1.102.0 001.75.527l2.96-2.41a.405.405.0 01.494-.013l5.34 3.87a1.1 1.1.0 001.046.135 1.1 1.1.0 00.682-.803l3.91-18.795A1.102 1.102.0 0022.5.075L.706 8.475z"/></svg></div></div></a><div id=disqus_thread></div><script type=text/javascript>(function(){if(window.location.hostname=="localhost")return;var e=document.createElement("script");e.async=!0,e.type="text/javascript",e.src="//definit.disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)})()</script><noscript>Please enable JavaScript to view the <a href=http://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><div class="clarity-prev-next col-xs-12 col-sm-12 col-md-12 col-lg-12"><nav class=clarity-page-prev-next><div class=clr-nav-previous><a href=https://www.definit.co.uk/2015/07/deploying-vmturbo-virtual-health-monitor/ title="Deploying VMTurbo Virtual Health Monitor" class="btn btn-sm btn-outline">Previous</a></div><div class=clr-nav-next><a href=https://www.definit.co.uk/2015/07/deploying-vrealize-automation-6-2-appliance-cluster-with-postgres-replication/ title="Deploying vRealize Automation 6.2 Appliance Cluster with Postgres Replication" class="btn btn-sm btn-outline">Next</a></div></nav></div></div><nav class="sidenav clr-col-12 clr-col-sm-12 clr-col-md-12 clr-col-lg-6 clr-col-xl-6"><section class=sidenav-content><section class="nav-group collapsible"><input id=Categories type=checkbox>
<label for=Categories>Categories</label><ul class=nav-list><li><a href=/category/career class=nav-link>CAREER <span class="badge badge-1">25</span></a></li><li><a href=/category/cloud-native class=nav-link>CLOUD-NATIVE <span class="badge badge-1">16</span></a></li><li><a href=/category/community class=nav-link>COMMUNITY <span class="badge badge-1">44</span></a></li><li><a href=/category/microsoft class=nav-link>MICROSOFT <span class="badge badge-1">60</span></a></li><li><a href=/category/networking class=nav-link>NETWORKING <span class="badge badge-1">29</span></a></li><li><a href=/category/nsx class=nav-link>NSX <span class="badge badge-1">16</span></a></li><li><a href=/category/vcf class=nav-link>VCF <span class="badge badge-1">2</span></a></li><li><a href=/category/vmware class=nav-link>VMWARE <span class="badge badge-1">206</span></a></li><li><a href=/category/vmware-aria class=nav-link>VMWARE-ARIA <span class="badge badge-1">1</span></a></li><li><a href=/category/vrealize-automation class=nav-link>VREALIZE-AUTOMATION <span class="badge badge-1">40</span></a></li><li><a href=/category/vrealize-operations class=nav-link>VREALIZE-OPERATIONS <span class="badge badge-1">71</span></a></li><li><a href=/category/vrealize-orchestrator class=nav-link>VREALIZE-ORCHESTRATOR <span class="badge badge-1">23</span></a></li><li><a href=/category/vsphere class=nav-link>VSPHERE <span class="badge badge-1">56</span></a></li></ul></section><section class="nav-group collapsible"><input id=Tags type=checkbox>
<label for=Tags>Tags (Top 10)</label><ul class=nav-list><li><a href=/tag/vrops class=nav-link>VROPS <span class="badge badge-1">68</span></a></li><li><a href=/tag/vmware class=nav-link>VMWARE <span class="badge badge-1">56</span></a></li><li><a href=/tag/automation class=nav-link>AUTOMATION <span class="badge badge-1">40</span></a></li><li><a href=/tag/windows class=nav-link>WINDOWS <span class="badge badge-1">38</span></a></li><li><a href=/tag/vmworld class=nav-link>VMWORLD <span class="badge badge-1">34</span></a></li><li><a href=/tag/esx-and-esxi class=nav-link>ESX-AND-ESXI <span class="badge badge-1">33</span></a></li><li><a href=/tag/vcenter-server class=nav-link>VCENTER-SERVER <span class="badge badge-1">33</span></a></li><li><a href=/tag/nsx class=nav-link>NSX <span class="badge badge-1">32</span></a></li><li><a href=/tag/vra class=nav-link>VRA <span class="badge badge-1">30</span></a></li><li><a href=/tag/webinar class=nav-link>WEBINAR <span class="badge badge-1">29</span></a></li></section></section></nav></div><script async src="https://www.googletagmanager.com/gtag/js?id=UA-4368767-1"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-4368767-1")</script><script src=/js/lightbox-plus-jquery.min.js></script></div></body></html>