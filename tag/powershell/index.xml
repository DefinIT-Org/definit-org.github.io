<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>PowerShell on DefinIT</title><link>https://www.definit.co.uk/tag/powershell/</link><description>Recent content in PowerShell on DefinIT</description><generator>Hugo -- gohugo.io</generator><language>en-gb</language><lastBuildDate>Fri, 30 Jun 2017 15:09:46 +0000</lastBuildDate><atom:link href="https://www.definit.co.uk/tag/powershell/index.xml" rel="self" type="application/rss+xml"/><item><title>PowerShell: Deploying vCenter High Availability in Advanced Mode</title><link>https://www.definit.co.uk/2017/06/powershell-deploying-vcenter-high-availability-in-advanced-mode/</link><pubDate>Fri, 30 Jun 2017 15:09:46 +0000</pubDate><guid>https://www.definit.co.uk/2017/06/powershell-deploying-vcenter-high-availability-in-advanced-mode/</guid><description>With the release of vSphere 6.5, VMware upped the game for vCenter High Availability (vCHA) and introduced an active/passive/witness cluster setup to provide a failover cluster for vCenter Server Appliances. The diagram below shows the architecture of the solution.
Deploying vCHA can be done in two modes - &amp;ldquo;Basic&amp;rdquo; and &amp;ldquo;Advanced&amp;rdquo;. You can use Basic mode if the vCenter you want to be HA is managing the hosts it resides on - in this scenario the wizard configures your vCenter and deploys the Passive and Witness nodes for you.</description></item><item><title>Installing .NET core, PowerShell and PowerCLI on macOS Sierra</title><link>https://www.definit.co.uk/2016/10/installing-net-core-powershell-and-powercli-on-macos-sierra/</link><pubDate>Tue, 18 Oct 2016 10:52:22 +0000</pubDate><guid>https://www.definit.co.uk/2016/10/installing-net-core-powershell-and-powercli-on-macos-sierra/</guid><description>So, this is something I&amp;rsquo;ve been waiting to write up for a while! PowerShell for macOS has been available for a while now, but what a lot of¬†PowerCLI fans have been waiting for is to be able to use PowerCLI direct from their Mac.
Today, amidst all of the noise from VMWorld, PowerCLI Core dropped as a Fling! That means that although it&amp;rsquo;s not ready for production use yet, it is ready to start testing - and I&amp;rsquo;m way more excited than I should be!</description></item><item><title>Configuring a vRO/vCAC PowerShell host with Basic Authentication</title><link>https://www.definit.co.uk/2014/12/configuring-a-vrovcac-powershell-host-with-basic-authentication/</link><pubDate>Tue, 23 Dec 2014 15:50:17 +0000</pubDate><guid>https://www.definit.co.uk/2014/12/configuring-a-vrovcac-powershell-host-with-basic-authentication/</guid><description>To add a Windows Server 2012 R2 PowerShell host using Basic Authentication only, follow these steps.
Ensure that the Windows Firewall service is running (it doesn&amp;rsquo;t matter if the firewall is enabled or disabled, it should always be running! That&amp;rsquo;s a general rule, not just for this).
On the PowerShell host open a command prompt (*NOT* PowerShell console) as administrator and run the quickconfig command - you can re-run it if it&amp;rsquo;s already been run - but make sure it has.</description></item><item><title>Configuring vCenter Orchestrator (vCO) with PowerShell over HTTPS with Kerberos Authentication</title><link>https://www.definit.co.uk/2014/07/configuring-vcenter-orchestrator-vco-with-powershell-over-https-with-kerberos-authentication/</link><pubDate>Wed, 23 Jul 2014 11:01:09 +0000</pubDate><guid>https://www.definit.co.uk/2014/07/configuring-vcenter-orchestrator-vco-with-powershell-over-https-with-kerberos-authentication/</guid><description>As a PowerShell fan I find using the vCO PowerShell plugin makes my life a whole lot easier. What isn&amp;rsquo;t easy however, is the configuration of vCO and a PowerShell jump host. Having done it a few times, this is my method for ensuring a secure working connection using HTTPS and Kerberos.
Configure the Orchestrator Appliance Since we‚Äôre planning on using Kerberos authentication, we‚Äôd better ensure that the time is correct AND syncs to the same source as the domain.</description></item><item><title>vCenter 5.5 Certificate Toolkit for Distributed Environments</title><link>https://www.definit.co.uk/2014/06/vcenter-5-5-certificate-toolkit-for-distributed-environments/</link><pubDate>Mon, 09 Jun 2014 10:50:43 +0000</pubDate><guid>https://www.definit.co.uk/2014/06/vcenter-5-5-certificate-toolkit-for-distributed-environments/</guid><description>Derek Seaman‚Äôs excellent SSL toolkit. I know that there are hours and hours of work put into this script by Derek and I want to thank him for that ‚Äì it‚Äôs a massive time saver. This modification is to fit a different set of circumstances ‚Äì ‚Äústanding on the shoulders of giants‚Äù ‚Äì and should in no way be seen as me criticising or stealing Derek‚Äôs work.
This week, while using the SSL Certificate Automation Tool and Derek‚Äôs script, I encountered a couple of things I felt could be improved for a more complex environment.</description></item><item><title>VCP5 ‚Äì vSphere 5 Configuration Maximums Quiz in PowerShell</title><link>https://www.definit.co.uk/2012/11/vcp5-vsphere-5-configuration-maximums-quiz-in-powershell/</link><pubDate>Thu, 22 Nov 2012 16:48:15 +0000</pubDate><guid>https://www.definit.co.uk/2012/11/vcp5-vsphere-5-configuration-maximums-quiz-in-powershell/</guid><description>I&amp;rsquo;ve been learning my vSphere 5 config maximums before my upcoming VCP5 exam, so in a supreme effort of procrastination I thought I&amp;rsquo;d write a PowerShell quiz script: here it is!
Save the QuizMe.ps1 file into a folder and then¬†place¬†one or more¬†text file in the same folder containing a comma delimited set of questions and answers. Then run QuizMe.ps1!
You can choose the quiz you take (which text file it will use).</description></item><item><title>Powershell ‚Äì Generate Microsoft CA signed SSL certificates with vSphere 5.1</title><link>https://www.definit.co.uk/2012/11/powershell-generate-microsoft-ca-signed-ssl-certificates-with-vsphere-5-1/</link><pubDate>Tue, 06 Nov 2012 16:59:11 +0000</pubDate><guid>https://www.definit.co.uk/2012/11/powershell-generate-microsoft-ca-signed-ssl-certificates-with-vsphere-5-1/</guid><description>The process of requesting certificates for vSphere 5.1 is a fairly grim, manual process. It&amp;rsquo;s repetitive and easy to make a mistake on any step of the way. Since I&amp;rsquo;ve got to do this for quite a few VirtualCenter Servers, I thought I&amp;rsquo;d script the certificate generation if nothing else. I am following the excellent¬†documentation provided in Implementing CA signed SSL certificates with vSphere 5.1¬†and more specifically in Creating certificate requests and certificates for vCenter Server 5.</description></item><item><title>SCOM 2007 R2: Daily Health Check Script v2</title><link>https://www.definit.co.uk/2012/05/scom-2007-r2-daily-health-check-script-v2/</link><pubDate>Mon, 28 May 2012 13:57:02 +0000</pubDate><guid>https://www.definit.co.uk/2012/05/scom-2007-r2-daily-health-check-script-v2/</guid><description>A couple of months ago¬†I posted the first version of my SCOM 2007 R2 Daily Health Check Script - here is version 2. It&amp;rsquo;s more than a little motivated by some friendly competition with a Microsoft PFE for SCOM, hopefully you&amp;rsquo;ll agree it&amp;rsquo;s a big improvement on the last version.
Updated for this version
Formatting changed to make it more readable and more compatible Added &amp;ldquo;Report generated on &amp;rdquo; to the top of the report Management Server states reported as one section Default MP check moved to beneath¬†the Management servers Agents in pending states moved to be with the Agent health states Clarified &amp;ldquo;Unresponsive Agents&amp;rdquo; and &amp;ldquo;Agents reporting errors&amp;rdquo; Management server alerts streamlined Added top 10 alerts for the last 7 days, and added top alerters for each I&amp;rsquo;m planning to wrap in some SQL database size checks and some of the other recommendations later - I&amp;rsquo;ll post again here when that&amp;rsquo;s ready üôÇ</description></item><item><title>PowerShell: Recursively taking ownership of files and folders and adding permissions without removing existing permissions</title><link>https://www.definit.co.uk/2012/02/powershell-recursively-taking-ownership-of-files-and-folders-and-adding-permissions-without-removing-existing-permissions/</link><pubDate>Tue, 07 Feb 2012 14:59:03 +0000</pubDate><guid>https://www.definit.co.uk/2012/02/powershell-recursively-taking-ownership-of-files-and-folders-and-adding-permissions-without-removing-existing-permissions/</guid><description>This is every file server admin&amp;rsquo;s nightmare: hundreds of shares, thousands of folders, hundreds of thousands of files - and custom or not inherited rights on many of them. Terabytes of data that need auditing - e.g. to find customer data, or credit card information. How do you go about accessing all the data in all the trees? What about backups failing because someone removed the System account? Of course you can seize control of the folder by taking ownership and pushing down from a top level - but how do you preserve the existing Access Control Lists?</description></item><item><title>SCOM 2007 R2: Daily Health Check Script</title><link>https://www.definit.co.uk/2012/01/scom-2007-r2-daily-health-check-script/</link><pubDate>Wed, 25 Jan 2012 16:59:39 +0000</pubDate><guid>https://www.definit.co.uk/2012/01/scom-2007-r2-daily-health-check-script/</guid><description>An updated version of this script has been released: https://www.definit.co.uk/2012/05/scom-2007-r2-daily-health-check-script-v2/
I&amp;rsquo;ve been working with a Microsft SCOM PFE (Premier Field Engineer) for the last few months and part of the engagement is an environment health check for the SCOM setup. Based on this Microsoft recommend a series of health checks to for the environment that should be carried out every day. This is summarised as the following:
Check the health of all Management Servers and Gateways Check the RMS is not in maintenance mode Review Outstanding Alerts Review Agent&amp;rsquo;s Health Status Review Backup Status Review any Management Group Alerts Review the Pending Management status Review Database Sizes (Operations, Data warehouse, ACS) Review Volume of Alerts Review Alert Latency Document any changes¬† From this, there are certain aspects that can&amp;rsquo;t be automated so easily, or¬†shouldn&amp;rsquo;t be¬†- e.</description></item><item><title>VMware PowerCLI ‚Äì Set Path Selection Policy on all LUNs for a host</title><link>https://www.definit.co.uk/2011/10/vmware-powercli-set-path-selection-policy-on-all-luns-for-a-host/</link><pubDate>Fri, 28 Oct 2011 11:08:40 +0000</pubDate><guid>https://www.definit.co.uk/2011/10/vmware-powercli-set-path-selection-policy-on-all-luns-for-a-host/</guid><description>Just a quick script to set the Path Selection Policy on any LUNs on a host that do not have your target policy enabled. The script sets the server to Maintenance mode first, evacuating any VMs if you are in a full DRS automated environment. While this is not strictly necessary, it was required for my production environment just to be safe.
param( [string] $vCenterServer = $(Read-Host -prompt "Enter vCenter Server Name"</description></item><item><title>SCOM 2007 DFS Backlog Monitoring ‚Äì Distributing a RunAs account to only DFS replication members</title><link>https://www.definit.co.uk/2011/10/scom-2007-dfs-backlog-monitoring-%E2%80%93-distributing-a-runas-account-to-only-dfs-replication-members/</link><pubDate>Tue, 18 Oct 2011 11:13:25 +0000</pubDate><guid>https://www.definit.co.uk/2011/10/scom-2007-dfs-backlog-monitoring-%E2%80%93-distributing-a-runas-account-to-only-dfs-replication-members/</guid><description>The DFS monitoring tool in SCOM 2007 has some great features, which will replace many a custom VB script running in enterprises. As with a lot of Management Packs, to get the most out of¬†it you need to have a dedicated RunAs account with local admin permissions on¬†the servers you are monitoring (e.g.¬†for the Backlogged Files reporting).
The easy (and wrong) option here is to go with the less secure option and distribute a RunAs account to ALL servers.</description></item><item><title>Exchange 2010 ‚Äì CreateTestUser : Mailbox could not be created. Verify that OU ( Users ) exists and that password meets complexity requirements</title><link>https://www.definit.co.uk/2011/03/exchange-2010-createtestuser-mailbox-could-not-be-created-verify-that-ou-users-exists-and-that-password-meets-complexity-requirements/</link><pubDate>Mon, 21 Mar 2011 14:56:39 +0000</pubDate><guid>https://www.definit.co.uk/2011/03/exchange-2010-createtestuser-mailbox-could-not-be-created-verify-that-ou-users-exists-and-that-password-meets-complexity-requirements/</guid><description>While using the New-TestCasConnectivityUser.ps1 script to create a test user for Exchange 2010‚Äôs connectivity testing, I ran into an issue:
CreateTestUser : Mailbox could not be created. Verify that OU ( Users ) exists and that password meets complexity requirements. At C:\Program Files\Microsoft\Exchange Server\V14\Scripts\new-TestCasConnectivityUser.ps1:255 char:27 +¬†$result = CreateTestUser &amp;lt;&amp;lt;&amp;lt;&amp;lt;¬†$exchangeServer $mailboxServer $securePassword $OrganizationalUnit $UMDialPlan $UMExtension $Prompt + CategoryInfo¬†: NotSpecified: (:) [Write-Error], WriteErrorException + FullyQualifiedErrorId : Microsoft.PowerShell.Commands.WriteErrorException,CreateTestUser Oddly enough, that OU does exist (as it will by default on any Windows Domain!</description></item><item><title>Reporting all ActiveSync devices and their Users in Exchange 2010</title><link>https://www.definit.co.uk/2011/02/reporting-all-activesync-devices-and-users-in-exchange-2010/</link><pubDate>Tue, 08 Feb 2011 14:28:14 +0000</pubDate><guid>https://www.definit.co.uk/2011/02/reporting-all-activesync-devices-and-users-in-exchange-2010/</guid><description>Recently I needed to report on the ActiveSync devices that were attached to our Exchange 2010 organisation, and which users they were accessing, and then export them to a CSV file.
This is the script:
$ActiveSyncDevices = @() ForEach ($Mailbox in Get-Mailbox ‚ÄìServer MBX01) { Get-ActiveSyncDeviceStatistics -Mailbox $Mailbox.Identity ‚ÄìErrorAction SilentlyContinue | Select DeviceFriendlyName, Devicetype, DeviceUserAgent | ForEach-Object { $_ | Add-Member ‚ÄìMemberType NoteProperty -Name "MailboxIdentity" -value $Mailbox $ActiveSyncDevices += $_ } } $ActiveSyncDevices | Export-csv c:\Path\To\File.</description></item><item><title>Using PowerShell to add IP addresses to IIS7&amp;rsquo;s FTP IPv4 Address and Domain Restrictions</title><link>https://www.definit.co.uk/2010/11/using-powershell-to-add-ip-addresses-to-iis7s-ftp-ipv4-address-and-domain-restrictions/</link><pubDate>Wed, 24 Nov 2010 10:55:04 +0000</pubDate><guid>https://www.definit.co.uk/2010/11/using-powershell-to-add-ip-addresses-to-iis7s-ftp-ipv4-address-and-domain-restrictions/</guid><description>Today I was configuring a new FTP server based on IIS7 (well, 7.5 technically as it‚Äôs a Server 2008 R2 host), and I wanted an easy way to add and remove allowed IP addresses based on either an XML config file or a CSV import. Customers‚Äô IP addresses are added or removed regularly, but I didn‚Äôt want to have to update their details twice, once on the server and once in the documents.</description></item><item><title>Creating/Enabling Exchange 2010 Personal Archives</title><link>https://www.definit.co.uk/2010/09/creatingenabling-exchange-2010-personal-archives/</link><pubDate>Mon, 13 Sep 2010 13:32:19 +0000</pubDate><guid>https://www.definit.co.uk/2010/09/creatingenabling-exchange-2010-personal-archives/</guid><description>With the release of Exchange 2010 SP1, administrators can now use separate Mailbox Databases to store the Personal Archives of users ‚Äì this is particularly useful if you have some larger, slower (and probably by virtue, older) storage that‚Äôs not really up to the I/O of your Exchange Server (that old SAN/NAS sitting in the corner of the server room?). It‚Äôs also useful if you just don‚Äôt have the capacity on your main storage.</description></item><item><title>Configuring Server 2008 R2 Core Series: Installing and Managing IIS</title><link>https://www.definit.co.uk/2010/03/configuring-server-2008-r2-core-series-installing-and-managing-iis/</link><pubDate>Wed, 24 Mar 2010 16:52:44 +0000</pubDate><guid>https://www.definit.co.uk/2010/03/configuring-server-2008-r2-core-series-installing-and-managing-iis/</guid><description>So, you‚Äôve installed a new server with Server 2008 R2 Core ‚Äì what next? Logging on, you‚Äôre presented with a shiny command prompt, you can run notepad or regedit‚Ä¶but aside from that, where do you go from there? In the next few series of posts I‚Äôll hopefully point out the basics, and some not so basics!
In this post, I‚Äôm covering Installing the IIS web server (and a few useful bits) and managing it from the IIS Management Snap-in.</description></item><item><title>Powershell script to zip all .bak files in a folder structure, then delete the .bak</title><link>https://www.definit.co.uk/2009/01/powershell-script-to-zip-all-bak-files-in-a-folder-structure-then-delete-the-bak/</link><pubDate>Tue, 20 Jan 2009 12:37:00 +0000</pubDate><guid>https://www.definit.co.uk/2009/01/powershell-script-to-zip-all-bak-files-in-a-folder-structure-then-delete-the-bak/</guid><description>Our development SQL server is a monster‚Ä¶there are many many databases, and hundreds, if not thousands of backup files. With each patch tested on the software we sell, there is a new backup. With each client deployment, a new database. With each new major version, a new database. Backups of the new databases inevitably occur, and so we have more files, in more folders - most of which need to be kept in case of roll-backs, bugs or deployment issues.</description></item><item><title>Vista .msu installer fails with error: Installer encountered an error: 0√ó80070422</title><link>https://www.definit.co.uk/2008/09/vista-msu-installer-fails-with-error-installer-encountered-an-error-0x80070422/</link><pubDate>Thu, 11 Sep 2008 10:11:00 +0000</pubDate><guid>https://www.definit.co.uk/2008/09/vista-msu-installer-fails-with-error-installer-encountered-an-error-0x80070422/</guid><description>I needed to use PowerShell for something today on my Vista laptop, but was unable to install the file. I had the normal UAC permission required when I ran it,¬†but then it failed with this error
Installer encountered an error: 0x80070422
The service cannot be started, either because it is disabled or because it
has no enabled devices associated with it.
It turns out that you need to enable the Windows Update service in order to use an MSU file.</description></item></channel></rss>