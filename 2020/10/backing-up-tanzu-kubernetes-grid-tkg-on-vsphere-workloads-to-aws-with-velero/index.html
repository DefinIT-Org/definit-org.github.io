<!doctype html><!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"><![endif]--><!--[if IE 7]><html class="no-js lt-ie9 lt-ie8"><![endif]--><!--[if IE 8]><html class="no-js lt-ie9"><![endif]--><!--[if gt IE 8]><!--><html class=no-js><!--<![endif]--><head><meta charset=utf-8><title>Backing up Tanzu Kubernetes Grid (TKG) on vSphere Workloads to AWS with Velero &#183; DefinIT</title><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=keywords content="kubernetes,vpshere,vmware,backup,velero,aws,s3,"><meta property="og:title" content="Backing up Tanzu Kubernetes Grid (TKG) on vSphere Workloads to AWS with Velero  &#183; DefinIT "><meta property="og:site_name" content="DefinIT"><meta property="og:url" content="https://www.definit.co.uk/2020/10/backing-up-tanzu-kubernetes-grid-tkg-on-vsphere-workloads-to-aws-with-velero/"><meta property="og:locale" content="en-gb"><meta property="og:type" content="article"><meta property="og:description" content><meta property="og:article:published_time" content="2020-10-07T00:00:00Z"><meta property="og:article:modified_time" content="2020-10-07T00:00:00Z"><meta property="og:article:tag" content="kubernetes"><meta property="og:article:tag" content="vpshere"><meta property="og:article:tag" content="vmware"><meta property="og:article:tag" content="backup"><meta property="og:article:tag" content="velero"><meta property="og:article:tag" content="aws"><meta property="og:article:tag" content="s3"><meta property="og:image" content="https://www.definit.co.uk/images/logos/velero.png"><meta name=twitter:card content="summary"><meta name=twitter:site content="@sammcgeown"><meta name=twitter:creator content="@sammcgeown"><meta name=twitter:title content="Backing up Tanzu Kubernetes Grid (TKG) on vSphere Workloads to AWS with Velero"><meta name=twitter:description content><meta name=twitter:url content="https://www.definit.co.uk/2020/10/backing-up-tanzu-kubernetes-grid-tkg-on-vsphere-workloads-to-aws-with-velero/"><meta name=twitter:domain content="https://www.definit.co.uk"><link rel=canonical href=https://www.definit.co.uk/2020/10/backing-up-tanzu-kubernetes-grid-tkg-on-vsphere-workloads-to-aws-with-velero/><link rel=apple-touch-icon-precomposed sizes=144x144 href=/touch-icon-144-precomposed.png><link rel=icon href=/images/favicon-16x16.png><meta name=generator content="Hugo 0.106.0"><!--[if lt IE 9]><script src=https://oss.maxcdn.com/libs/html5shiv/3.7.2/html5shiv.js></script>
<script src=https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js></script><![endif]--><script src=/js/clr-icons.min.js></script>
<script src=/js/custom-elements.min.js></script>
<link href=/css/clr-ui.min.css rel=stylesheet><link href=/css/clr-icons.min.css rel=stylesheet><link href=/css/definit-clarity.css rel=stylesheet><link href=/css/lightbox.min.css rel=stylesheet></head><body data-ng-app=myapp data-ng-controller=MyController data-ng-mouseleave=MouseLeave($event)><div class=main-container><header class=header-6><div class=branding><a class=navbar-brand-img href=/><img alt src=/images/logos/definit-logo.png>
<span class=title>DefinIT</span></a></div><nav class=header-nav><a class="nav-link nav-text" href=https://www.definit.co.uk/ title=Home>Home</a>
<a class="nav-link nav-text" href=https://www.definit.co.uk/about/ title=About>About</a>
<a class="nav-link nav-text" href=https://www.github.com/sammcgeown title=GitHub>GitHub</a>
<a class="nav-link nav-text" href=https://www.definit.co.uk/index.xml title=RSS>RSS</a></nav><div class=header-actions><form class=search id=search method=get action=//google.com/search><label for=search_input><input id=search_input type=text name=q placeholder="Search with Google">
<input type=hidden name=as_sitesearch value=https://www.definit.co.uk></label></form></div></header><div class=content-container><div class=content-area><h1>Backing up Tanzu Kubernetes Grid (TKG) on vSphere Workloads to AWS with Velero</h1><div class=metas><span class=clr-card-authors><div class=clr-card-authors><img src=/images/SamMcGeown2020.jpg alt class=img-author>Written by <a href=https://www.definit.co.uk/authors/sam-mcgeown/>Sam McGeown</a>
on 7/10/2020
&#183; Read in about 6 min (1209 words)</div><div class=clr-card-authors>Published under <a href=/category/cloud-native>Cloud-Native</a> and <a href=/category/vmware>VMware</a></div><div class=clr-card-authors>Tags:
<a class=clr-tags href=https://www.definit.co.uk/tag/kubernetes>#kubernetes</a>
<a class=clr-tags href=https://www.definit.co.uk/tag/vpshere>#vpshere</a>
<a class=clr-tags href=https://www.definit.co.uk/tag/vmware>#vmware</a>
<a class=clr-tags href=https://www.definit.co.uk/tag/backup>#backup</a>
<a class=clr-tags href=https://www.definit.co.uk/tag/velero>#velero</a>
<a class=clr-tags href=https://www.definit.co.uk/tag/aws>#aws</a>
<a class=clr-tags href=https://www.definit.co.uk/tag/s3>#s3</a></div></span></div><br clear=all><div class="alert alert-danger" role=alert><div class=alert-items><div class="alert-item static"><div class=alert-icon-wrapper><clr-icon class=alert-icon shape=warning-standard></clr-icon></div><span class=alert-text>This article is now 2 years old! It is highly likely that this information is out of date and the author will have completely forgotten about it. Please take care when following any guidance to ensure you have up-to-date recommendations.</span></div></div></div><img src=/images/logos/velero.png class=clr-post-featured-image><p>As more services go live on my Kubernetes clusters and more people start relying on them, I get nervous. For the most part, I try and keep my applications and configurations stateless - relying on <code>ConfigMaps</code> for example to store application configuration. This means with a handful of YAML files in my Git repository I can restore everything to working order. Sometimes though, there&rsquo;s no choice but to use a <code>PersistentVolume</code> to provide some data persistance where you can&rsquo;t capture it in a config file. This is where a backup of the cluster - and specifically the <code>PersistentVolume</code> is really important.</p><p>Enter <a href=https://velero.io/>Velero</a> - the artist formerly known as Heptio Ark.</p><blockquote><p>Velero is an open source tool to safely backup and restore, perform disaster recovery, and migrate Kubernetes cluster resources and persistent volumes.</p></blockquote><p>Velero uses <a href=https://velero.io/plugins/>plugins</a> to integrate with various cloud providers, allowing you to backup to different targets - my aim is to backup my vSphere-based (CSI) Persistent Volumes to AWS S3.</p><h2 id=set-up-aws>Set up AWS <a class=anchor href=#set-up-aws><i class="fas fa-hashtag"></i></a></h2><p>You can set up all the required components using the AWS console, but my preference is to use the AWS CLI.</p><h3 id=create-a-new-access-key>Create a new Access Key <a class=anchor href=#create-a-new-access-key><i class="fas fa-hashtag"></i></a></h3><p>To use the AWS CLI you&rsquo;ll need an Access Key. Log onto your AWS console, go to &ldquo;My Security Credentials&rdquo; and create an Access Key (if you&rsquo;ve not already got one)</p><p><img src=2020-10-07-14-21-12.png alt></p><p><img src=2020-10-09-16-52-26.png alt></p><p>Keep the details safe (I store mine in my password manager).</p><h3 id=install-aws-cli>Install AWS CLI <a class=anchor href=#install-aws-cli><i class="fas fa-hashtag"></i></a></h3><p>I&rsquo;m using <a href=https://brew.sh/>homebrew</a> to install the AWS CLI, and other packages, because I&rsquo;m on a Mac - check out the <a href=https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2.html>official install docs</a> for other OSes.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>brew install awscli
</span></span></code></pre></td></tr></table></div></div><h3 id=configure-a-new-profile>Configure a new profile <a class=anchor href=#configure-a-new-profile><i class="fas fa-hashtag"></i></a></h3><blockquote><p>Note: <em>I&rsquo;m using a named profile as I&rsquo;ve got a few accounts - you can omit this if you are just setting up the one</em></p></blockquote><p>Lets set up some variables first:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>BUCKET</span><span class=o>=</span>prod-cluster-backup <span class=c1># The name of your S3 bucket to create</span>
</span></span><span class=line><span class=cl><span class=nv>REGION</span><span class=o>=</span>us-west-1 <span class=c1># AWS Region in which to create the S3 bucket</span>
</span></span><span class=line><span class=cl><span class=nv>PROFILE</span><span class=o>=</span>my-profile <span class=c1># Only needed if you&#39;re creating a named profile for AWS CLI</span>
</span></span></code></pre></td></tr></table></div></div><p>Configure your AWS profile (omit <code>--profile $PROFILE</code> if you&rsquo;re using the default profile)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>aws configure --profile <span class=nv>$PROFILE</span>
</span></span><span class=line><span class=cl>&gt; AWS Access Key ID <span class=o>[</span>None<span class=o>]</span>: AKIAIOSFODNN7EXAMPLE
</span></span><span class=line><span class=cl>&gt; AWS Secret Access Key <span class=o>[</span>None<span class=o>]</span>: wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY
</span></span><span class=line><span class=cl>&gt; Default region name <span class=o>[</span>None<span class=o>]</span>: us-west-2
</span></span><span class=line><span class=cl>&gt; Default output format <span class=o>[</span>None<span class=o>]</span>: ENTER
</span></span></code></pre></td></tr></table></div></div><h3 id=create-an-s3-bucket-for-the-backups>Create an S3 bucket for the backups: <a class=anchor href=#create-an-s3-bucket-for-the-backups><i class="fas fa-hashtag"></i></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>aws s3api create-bucket <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --bucket <span class=nv>$BUCKET</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --region <span class=nv>$REGION</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --create-bucket-configuration <span class=nv>LocationConstraint</span><span class=o>=</span><span class=nv>$REGION</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --profile <span class=nv>$PROFILE</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=create-an-iam-user>Create an IAM user <a class=anchor href=#create-an-iam-user><i class="fas fa-hashtag"></i></a></h3><p>I&rsquo;m creating a user with the same name as my bucket - since this user and bucket will be used to back up a single cluster, it makes sense for me to be able to identify and link the two by name.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>aws iam create-user --user-name <span class=nv>$BUCKET</span> --profile <span class=nv>$PROFILE</span>
</span></span></code></pre></td></tr></table></div></div><p>Create a JSON file with a policy definition of the permissions velero needs - note that it&rsquo;s scoped to the specific bucket using the $BUCKET variable:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat &gt; velero-policy.json <span class=s>&lt;&lt;EOF
</span></span></span><span class=line><span class=cl><span class=s>{
</span></span></span><span class=line><span class=cl><span class=s>    &#34;Version&#34;: &#34;2012-10-17&#34;,
</span></span></span><span class=line><span class=cl><span class=s>    &#34;Statement&#34;: [
</span></span></span><span class=line><span class=cl><span class=s>        {
</span></span></span><span class=line><span class=cl><span class=s>            &#34;Effect&#34;: &#34;Allow&#34;,
</span></span></span><span class=line><span class=cl><span class=s>            &#34;Action&#34;: [
</span></span></span><span class=line><span class=cl><span class=s>                &#34;ec2:DescribeVolumes&#34;,
</span></span></span><span class=line><span class=cl><span class=s>                &#34;ec2:DescribeSnapshots&#34;,
</span></span></span><span class=line><span class=cl><span class=s>                &#34;ec2:CreateTags&#34;,
</span></span></span><span class=line><span class=cl><span class=s>                &#34;ec2:CreateVolume&#34;,
</span></span></span><span class=line><span class=cl><span class=s>                &#34;ec2:CreateSnapshot&#34;,
</span></span></span><span class=line><span class=cl><span class=s>                &#34;ec2:DeleteSnapshot&#34;
</span></span></span><span class=line><span class=cl><span class=s>            ],
</span></span></span><span class=line><span class=cl><span class=s>            &#34;Resource&#34;: &#34;*&#34;
</span></span></span><span class=line><span class=cl><span class=s>        },
</span></span></span><span class=line><span class=cl><span class=s>        {
</span></span></span><span class=line><span class=cl><span class=s>            &#34;Effect&#34;: &#34;Allow&#34;,
</span></span></span><span class=line><span class=cl><span class=s>            &#34;Action&#34;: [
</span></span></span><span class=line><span class=cl><span class=s>                &#34;s3:GetObject&#34;,
</span></span></span><span class=line><span class=cl><span class=s>                &#34;s3:DeleteObject&#34;,
</span></span></span><span class=line><span class=cl><span class=s>                &#34;s3:PutObject&#34;,
</span></span></span><span class=line><span class=cl><span class=s>                &#34;s3:AbortMultipartUpload&#34;,
</span></span></span><span class=line><span class=cl><span class=s>                &#34;s3:ListMultipartUploadParts&#34;
</span></span></span><span class=line><span class=cl><span class=s>            ],
</span></span></span><span class=line><span class=cl><span class=s>            &#34;Resource&#34;: [
</span></span></span><span class=line><span class=cl><span class=s>                &#34;arn:aws:s3:::${BUCKET}/*&#34;
</span></span></span><span class=line><span class=cl><span class=s>            ]
</span></span></span><span class=line><span class=cl><span class=s>        },
</span></span></span><span class=line><span class=cl><span class=s>        {
</span></span></span><span class=line><span class=cl><span class=s>            &#34;Effect&#34;: &#34;Allow&#34;,
</span></span></span><span class=line><span class=cl><span class=s>            &#34;Action&#34;: [
</span></span></span><span class=line><span class=cl><span class=s>                &#34;s3:ListBucket&#34;
</span></span></span><span class=line><span class=cl><span class=s>            ],
</span></span></span><span class=line><span class=cl><span class=s>            &#34;Resource&#34;: [
</span></span></span><span class=line><span class=cl><span class=s>                &#34;arn:aws:s3:::${BUCKET}&#34;
</span></span></span><span class=line><span class=cl><span class=s>            ]
</span></span></span><span class=line><span class=cl><span class=s>        }
</span></span></span><span class=line><span class=cl><span class=s>    ]
</span></span></span><span class=line><span class=cl><span class=s>}
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span></code></pre></td></tr></table></div></div><p>Attach the policy to the user to allow it to access the S3 bucket.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>aws iam put-user-policy <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --user-name <span class=nv>$BUCKET</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --policy-name <span class=nv>$BUCKET</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --policy-document file://velero-policy.json <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --profile <span class=nv>$PROFILE</span>
</span></span></code></pre></td></tr></table></div></div><p>We can then create an Access Key for the newly created account, which will be used by Velero to upload the data.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>aws iam create-access-key --user-name <span class=nv>$BUCKET</span> --profile <span class=nv>$PROFILE</span>
</span></span></code></pre></td></tr></table></div></div><p>The response should include an <code>AccessKeyId</code> and <code>SecretAccessKey</code> - make a note of them:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;AccessKey&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;UserName&#34;</span><span class=p>:</span> <span class=s2>&#34;prod-cluster-backup&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;AccessKeyId&#34;</span><span class=p>:</span> <span class=s2>&#34;AKIA4Z..snip..N7QGT5&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;Status&#34;</span><span class=p>:</span> <span class=s2>&#34;Active&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;SecretAccessKey&#34;</span><span class=p>:</span> <span class=s2>&#34;gqjNLeZ..snip..hnGJjNKU&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;CreateDate&#34;</span><span class=p>:</span> <span class=s2>&#34;2020-10-07T15:14:08+00:00&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Next we create a credentials file using the Access Key created above - this will be imported into the Velero deployment as a secret.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat &gt; credentials-prod-cluster-backup <span class=s>&lt;&lt;EOF
</span></span></span><span class=line><span class=cl><span class=s>[default]
</span></span></span><span class=line><span class=cl><span class=s>aws_access_key_id=&lt;AccessKeyId&gt;
</span></span></span><span class=line><span class=cl><span class=s>aws_secret_access_key=&lt;SecretAccessKey&gt;
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=install-and-configure-velero>Install and Configure Velero <a class=anchor href=#install-and-configure-velero><i class="fas fa-hashtag"></i></a></h2><p>Once again I&rsquo;m using <a href=https://brew.sh>homebrew</a> to install Velero - <a href=https://velero.io/docs/v1.5/basic-install/#install-the-cli>other installation instructions are a here</a></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>brew install velero
</span></span></code></pre></td></tr></table></div></div><p>Install Velero into your Kubernetes cluster using the CLI - your <code>kubectl</code> context should be pointed to the cluster you want to install on!</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>velero install <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --provider aws <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --plugins velero/velero-plugin-for-aws:v1.1.0 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --bucket <span class=nv>$BUCKET</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --backup-location-config <span class=nv>region</span><span class=o>=</span><span class=nv>$REGION</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --secret-file ./credentials-prod-cluster-backup <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --use-volume-snapshots<span class=o>=</span><span class=nb>false</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --use-restic
</span></span></code></pre></td></tr></table></div></div><p>At this point you could use <code>velero backup create</code> to start backing things up, but Velero won&rsquo;t automatically backup your persistent volumes - you need to tell it what to backup using an annotation. Without annotating the pods the backup will complete and look successful but it won&rsquo;t include your data!</p><h3 id=annotate-deployments-stateful-sets-or-pods>Annotate deployments, stateful sets or pods <a class=anchor href=#annotate-deployments-stateful-sets-or-pods><i class="fas fa-hashtag"></i></a></h3><p>Let&rsquo;s take my Vault deployment, for example. It consists of a stateful set of three pods, each pod has a persistant volume called &ldquo;data&rdquo;. Prior to deployment I can add the <code>backup.velero.io/backup-volumes: &lt;volume name></code> annotation to the template metadata in my YAML configuration:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>StatefulSet</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app.kubernetes.io/instance</span><span class=p>:</span><span class=w> </span><span class=l>vault</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app.kubernetes.io/name</span><span class=p>:</span><span class=w> </span><span class=l>vault</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>vault</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>vault</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app.kubernetes.io/instance</span><span class=p>:</span><span class=w> </span><span class=l>vault</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app.kubernetes.io/name</span><span class=p>:</span><span class=w> </span><span class=l>vault</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>serviceName</span><span class=p>:</span><span class=w> </span><span class=l>vault-internal</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>annotations</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>backup.velero.io/backup-volumes</span><span class=p>:</span><span class=w> </span><span class=l>data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app.kubernetes.io/instance</span><span class=p>:</span><span class=w> </span><span class=l>vault</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app.kubernetes.io/name</span><span class=p>:</span><span class=w> </span><span class=l>vault</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>Alternatively I could annotate the <code>pods</code> directly, but remember these annotations might be overwritten at a later point by the <code>statefulset</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl annotate pod/vault-0 backup.velero.io/backup-volumes<span class=o>=</span>data
</span></span><span class=line><span class=cl>kubectl annotate pod/vault-1 backup.velero.io/backup-volumes<span class=o>=</span>data
</span></span><span class=line><span class=cl>kubectl annotate pod/vault-2 backup.velero.io/backup-volumes<span class=o>=</span>data
</span></span></code></pre></td></tr></table></div></div><p>Now I can generate a backup of my <code>vault</code> namespace using:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>velero backup create vault-backup-test-1 --include-namespaces<span class=o>=</span>vault
</span></span></code></pre></td></tr></table></div></div><p>You can create a backup of your entire cluster using <code>velero backup create whole-cluster-backup</code>, or you can create scheduled backups using a cron-like schedule</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>velero create schedule whole-cluster-backup-daily --schedule<span class=o>=</span><span class=s2>&#34;0 7 * * *&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>It&rsquo;s also worth noting you can <em>exclude</em> specific namespaces as well as include, using <code>--exclude-namespaces</code>.</p><p>Once I&rsquo;ve created a backup, I can view it using:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>velero backup describe vault-backup-test-1
</span></span><span class=line><span class=cl>Name:         vault-backup-test-1
</span></span><span class=line><span class=cl>Namespace:    velero
</span></span><span class=line><span class=cl>Labels:       velero.io/storage-location<span class=o>=</span>default
</span></span><span class=line><span class=cl>Annotations:  velero.io/source-cluster-k8s-gitversion<span class=o>=</span>v1.19.1+vmware.2
</span></span><span class=line><span class=cl>              velero.io/source-cluster-k8s-major-version<span class=o>=</span><span class=m>1</span>
</span></span><span class=line><span class=cl>              velero.io/source-cluster-k8s-minor-version<span class=o>=</span><span class=m>19</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Phase:  Completed
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Errors:    <span class=m>0</span>
</span></span><span class=line><span class=cl>Warnings:  <span class=m>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Namespaces:
</span></span><span class=line><span class=cl>  Included:  vault
</span></span><span class=line><span class=cl>  Excluded:  &lt;none&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Resources:
</span></span><span class=line><span class=cl>  Included:        *
</span></span><span class=line><span class=cl>  Excluded:        &lt;none&gt;
</span></span><span class=line><span class=cl>  Cluster-scoped:  auto
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Label selector:  &lt;none&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Storage Location:  default
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Velero-Native Snapshot PVs:  auto
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TTL:  720h0m0s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Hooks:  &lt;none&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Backup Format Version:  1.1.0
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Started:    2020-10-09 16:25:13 +0100 BST
</span></span><span class=line><span class=cl>Completed:  2020-10-09 16:25:32 +0100 BST
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Expiration:  2020-11-08 15:25:13 +0000 GMT
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Total items to be backed up:  <span class=m>48</span>
</span></span><span class=line><span class=cl>Items backed up:              <span class=m>48</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Velero-Native Snapshots: &lt;none included&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Restic Backups <span class=o>(</span>specify --details <span class=k>for</span> more information<span class=o>)</span>:
</span></span><span class=line><span class=cl>  Completed:  <span class=m>3</span>
</span></span></code></pre></td></tr></table></div></div><h6>Share this post</h6><span class=share-box><a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.definit.co.uk%2f2020%2f10%2fbacking-up-tanzu-kubernetes-grid-tkg-on-vsphere-workloads-to-aws-with-velero%2f" onclick='return window.open(this.href,"mywin","left=20,top=20,width=500,height=500,toolbar=1,resizable=0"),!1'><i class="fa fa-facebook-official"></i></a>
<a href="https://twitter.com/intent/tweet?text=Backing%20up%20Tanzu%20Kubernetes%20Grid%20%28TKG%29%20on%20vSphere%20Workloads%20to%20AWS%20with%20Velero&url=https%3a%2f%2fwww.definit.co.uk%2f2020%2f10%2fbacking-up-tanzu-kubernetes-grid-tkg-on-vsphere-workloads-to-aws-with-velero%2f" onclick='return window.open(this.href,"mywin","left=20,top=20,width=500,height=500,toolbar=1,resizable=0"),!1'><i class="fa fa-twitter"></i></a>
<a href="https://plus.google.com/share?url=https%3a%2f%2fwww.definit.co.uk%2f2020%2f10%2fbacking-up-tanzu-kubernetes-grid-tkg-on-vsphere-workloads-to-aws-with-velero%2f" onclick='return window.open(this.href,"mywin","left=20,top=20,width=500,height=500,toolbar=1,resizable=0"),!1'><i class="fa fa-google-plus"></i></a>
<a href="http://www.reddit.com/submit?url=https%3a%2f%2fwww.definit.co.uk%2f2020%2f10%2fbacking-up-tanzu-kubernetes-grid-tkg-on-vsphere-workloads-to-aws-with-velero%2f" onclick='return window.open(this.href,"mywin","left=20,top=20,width=900,height=500,toolbar=1,resizable=0"),!1'><i class="fa fa-reddit"></i></a>
<a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fwww.definit.co.uk%2f2020%2f10%2fbacking-up-tanzu-kubernetes-grid-tkg-on-vsphere-workloads-to-aws-with-velero%2f&title=Backing%20up%20Tanzu%20Kubernetes%20Grid%20%28TKG%29%20on%20vSphere%20Workloads%20to%20AWS%20with%20Velero" onclick='return window.open(this.href,"mywin","left=20,top=20,width=500,height=500,toolbar=1,resizable=0"),!1'><i class="fa fa-linkedin"></i></a>
<a href="mailto:?subject=Backing%20up%20Tanzu%20Kubernetes%20Grid%20%28TKG%29%20on%20vSphere%20Workloads%20to%20AWS%20with%20Velero&body=Check out this site https%3a%2f%2fwww.definit.co.uk%2f2020%2f10%2fbacking-up-tanzu-kubernetes-grid-tkg-on-vsphere-workloads-to-aws-with-velero%2f" data-proofer-ignore><i class="fa fa-envelope"></i></a></span>
<a class=resp-sharing-button__link href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.definit.co.uk%2f2020%2f10%2fbacking-up-tanzu-kubernetes-grid-tkg-on-vsphere-workloads-to-aws-with-velero%2f" target=_blank rel=noopener aria-label><div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.77 7.46H14.5v-1.9c0-.9.6-1.1 1-1.1h3V.5h-4.33C10.24.5 9.5 3.44 9.5 5.32v2.15h-3v4h3v12h5v-12h3.85l.42-4z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://twitter.com/intent/tweet/?text=Backing%20up%20Tanzu%20Kubernetes%20Grid%20%28TKG%29%20on%20vSphere%20Workloads%20to%20AWS%20with%20Velero&url=https%3a%2f%2fwww.definit.co.uk%2f2020%2f10%2fbacking-up-tanzu-kubernetes-grid-tkg-on-vsphere-workloads-to-aws-with-velero%2f" target=_blank rel=noopener aria-label><div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M23.44 4.83c-.8.37-1.5.38-2.22.02.93-.56.98-.96 1.32-2.02-.88.52-1.86.9-2.9 1.1-.82-.88-2-1.43-3.3-1.43-2.5.0-4.55 2.04-4.55 4.54.0.36.03.7.1 1.04-3.77-.2-7.12-2-9.36-4.75-.4.67-.6 1.45-.6 2.3.0 1.56.8 2.95 2 3.77-.74-.03-1.44-.23-2.05-.57v.06c0 2.2 1.56 4.03 3.64 4.44-.67.2-1.37.2-2.06.08.58 1.8 2.26 3.12 4.25 3.16C5.78 18.1 3.37 18.74 1 18.46c2 1.3 4.4 2.04 6.97 2.04 8.35.0 12.92-6.92 12.92-12.93.0-.2.0-.4-.02-.6.9-.63 1.96-1.22 2.56-2.14z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://www.tumblr.com/widgets/share/tool?posttype=link&title=Backing%20up%20Tanzu%20Kubernetes%20Grid%20%28TKG%29%20on%20vSphere%20Workloads%20to%20AWS%20with%20Velero&caption=Backing%20up%20Tanzu%20Kubernetes%20Grid%20%28TKG%29%20on%20vSphere%20Workloads%20to%20AWS%20with%20Velero&content=https%3a%2f%2fwww.definit.co.uk%2f2020%2f10%2fbacking-up-tanzu-kubernetes-grid-tkg-on-vsphere-workloads-to-aws-with-velero%2f&canonicalUrl=https%3a%2f%2fwww.definit.co.uk%2f2020%2f10%2fbacking-up-tanzu-kubernetes-grid-tkg-on-vsphere-workloads-to-aws-with-velero%2f&shareSource=tumblr_share_button" target=_blank rel=noopener aria-label><div class="resp-sharing-button resp-sharing-button--tumblr resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13.5.5v5h5v4h-5V15c0 5 3.5 4.4 6 2.8v4.4c-6.7 3.2-12 0-12-4.2V9.5h-3V6.7c1-.3 2.2-.7 3-1.3.5-.5 1-1.2 1.4-2 .3-.7.6-1.7.7-3h3.8z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fwww.definit.co.uk%2f2020%2f10%2fbacking-up-tanzu-kubernetes-grid-tkg-on-vsphere-workloads-to-aws-with-velero%2f&title=Backing%20up%20Tanzu%20Kubernetes%20Grid%20%28TKG%29%20on%20vSphere%20Workloads%20to%20AWS%20with%20Velero&summary=Backing%20up%20Tanzu%20Kubernetes%20Grid%20%28TKG%29%20on%20vSphere%20Workloads%20to%20AWS%20with%20Velero&source=https%3a%2f%2fwww.definit.co.uk%2f2020%2f10%2fbacking-up-tanzu-kubernetes-grid-tkg-on-vsphere-workloads-to-aws-with-velero%2f" target=_blank rel=noopener aria-label><div class="resp-sharing-button resp-sharing-button--linkedin resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6.5 21.5h-5v-13h5v13zM4 6.5C2.5 6.5 1.5 5.3 1.5 4s1-2.4 2.5-2.4c1.6.0 2.5 1 2.6 2.5.0 1.4-1 2.5-2.6 2.5zm11.5 6c-1 0-2 1-2 2v7h-5v-13h5V10s1.6-1.5 4-1.5c3 0 5 2.2 5 6.3v6.7h-5v-7c0-1-1-2-2-2z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://reddit.com/submit/?url=https%3a%2f%2fwww.definit.co.uk%2f2020%2f10%2fbacking-up-tanzu-kubernetes-grid-tkg-on-vsphere-workloads-to-aws-with-velero%2f&resubmit=true&title=Backing%20up%20Tanzu%20Kubernetes%20Grid%20%28TKG%29%20on%20vSphere%20Workloads%20to%20AWS%20with%20Velero" target=_blank rel=noopener aria-label><div class="resp-sharing-button resp-sharing-button--reddit resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M24 11.5c0-1.65-1.35-3-3-3-.96.0-1.86.48-2.42 1.24-1.64-1-3.75-1.64-6.07-1.72.08-1.1.4-3.05 1.52-3.7.72-.4 1.73-.24 3 .5C17.2 6.3 18.46 7.5 20 7.5c1.65.0 3-1.35 3-3s-1.35-3-3-3c-1.38.0-2.54.94-2.88 2.22-1.43-.72-2.64-.8-3.6-.25-1.64.94-1.95 3.47-2 4.55-2.33.08-4.45.7-6.1 1.72C4.86 8.98 3.96 8.5 3 8.5c-1.65.0-3 1.35-3 3 0 1.32.84 2.44 2.05 2.84-.03.22-.05.44-.05.66.0 3.86 4.5 7 10 7s10-3.14 10-7c0-.22-.02-.44-.05-.66 1.2-.4 2.05-1.54 2.05-2.84zM2.3 13.37C1.5 13.07 1 12.35 1 11.5c0-1.1.9-2 2-2 .64.0 1.22.32 1.6.82-1.1.85-1.92 1.9-2.3 3.05zm3.7.13c0-1.1.9-2 2-2s2 .9 2 2-.9 2-2 2-2-.9-2-2zm9.8 4.8c-1.08.63-2.42.96-3.8.96-1.4.0-2.74-.34-3.8-.95-.24-.13-.32-.44-.2-.68.15-.24.46-.32.7-.18 1.83 1.06 4.76 1.06 6.6.0.23-.13.53-.05.67.2.14.23.06.54-.18.67zm.2-2.8c-1.1.0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm5.7-2.13c-.38-1.16-1.2-2.2-2.3-3.05.38-.5.97-.82 1.6-.82 1.1.0 2 .9 2 2 0 .84-.53 1.57-1.3 1.87z"/></svg></div></div></a><a class=resp-sharing-button__link href="mailto:?subject=Backing%20up%20Tanzu%20Kubernetes%20Grid%20%28TKG%29%20on%20vSphere%20Workloads%20to%20AWS%20with%20Velero&body=https%3a%2f%2fwww.definit.co.uk%2f2020%2f10%2fbacking-up-tanzu-kubernetes-grid-tkg-on-vsphere-workloads-to-aws-with-velero%2f" target=_self rel=noopener aria-label><div class="resp-sharing-button resp-sharing-button--email resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M22 4H2C.9 4 0 4.9.0 6v12c0 1.1.9 2 2 2h20c1.1.0 2-.9 2-2V6c0-1.1-.9-2-2-2zM7.25 14.43l-3.5 2c-.08.05-.17.07-.25.07-.17.0-.34-.1-.43-.25-.14-.24-.06-.55.18-.68l3.5-2c.24-.14.55-.06.68.18.14.24.06.55-.18.68zm4.75.07c-.1.0-.2-.03-.27-.08l-8.5-5.5c-.23-.15-.3-.46-.15-.7.15-.22.46-.3.7-.14L12 13.4l8.23-5.32c.23-.15.54-.08.7.15.14.23.07.54-.16.7l-8.5 5.5c-.08.04-.17.07-.27.07zm8.93 1.75c-.1.16-.26.25-.43.25-.08.0-.17-.02-.25-.07l-3.5-2c-.24-.13-.32-.44-.18-.68s.44-.32.68-.18l3.5 2c.24.13.32.44.18.68z"/></svg></div></div></a><a class=resp-sharing-button__link href="whatsapp://send?text=Backing%20up%20Tanzu%20Kubernetes%20Grid%20%28TKG%29%20on%20vSphere%20Workloads%20to%20AWS%20with%20Velero%20https%3a%2f%2fwww.definit.co.uk%2f2020%2f10%2fbacking-up-tanzu-kubernetes-grid-tkg-on-vsphere-workloads-to-aws-with-velero%2f" target=_blank rel=noopener aria-label><div class="resp-sharing-button resp-sharing-button--whatsapp resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.1 3.9C17.9 1.7 15 .5 12 .5 5.8.5.7 5.6.7 11.9c0 2 .5 3.9 1.5 5.6L.6 23.4l6-1.6c1.6.9 3.5 1.3 5.4 1.3 6.3.0 11.4-5.1 11.4-11.4-.1-2.8-1.2-5.7-3.3-7.8zM12 21.4c-1.7.0-3.3-.5-4.8-1.3l-.4-.2-3.5 1 1-3.4L4 17c-1-1.5-1.4-3.2-1.4-5.1.0-5.2 4.2-9.4 9.4-9.4 2.5.0 4.9 1 6.7 2.8s2.8 4.2 2.8 6.7c-.1 5.2-4.3 9.4-9.5 9.4zm5.1-7.1c-.3-.1-1.7-.9-1.9-1-.3-.1-.5-.1-.7.1-.2.3-.8 1-.9 1.1-.2.2-.3.2-.6.1s-1.2-.5-2.3-1.4c-.9-.8-1.4-1.7-1.6-2s0-.5.1-.6.3-.3.4-.5c.2-.1.3-.3.4-.5s0-.4.0-.5C10 9 9.3 7.6 9 7c-.1-.4-.4-.3-.5-.3h-.6s-.4.1-.7.3c-.3.3-1 1-1 2.4s1 2.8 1.1 3c.1.2 2 3.1 4.9 4.3.7.3 1.2.5 1.6.6.7.2 1.3.2 1.8.1.6-.1 1.7-.7 1.9-1.3.2-.7.2-1.2.2-1.3-.1-.3-.3-.4-.6-.5z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://telegram.me/share/url?text=Backing%20up%20Tanzu%20Kubernetes%20Grid%20%28TKG%29%20on%20vSphere%20Workloads%20to%20AWS%20with%20Velero&url=https%3a%2f%2fwww.definit.co.uk%2f2020%2f10%2fbacking-up-tanzu-kubernetes-grid-tkg-on-vsphere-workloads-to-aws-with-velero%2f" target=_blank rel=noopener aria-label><div class="resp-sharing-button resp-sharing-button--telegram resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M.707 8.475C.275 8.64.0 9.508.0 9.508s.284.867.718 1.03l5.09 1.897 1.986 6.38a1.102 1.102.0 001.75.527l2.96-2.41a.405.405.0 01.494-.013l5.34 3.87a1.1 1.1.0 001.046.135 1.1 1.1.0 00.682-.803l3.91-18.795A1.102 1.102.0 0022.5.075L.706 8.475z"/></svg></div></div></a><div id=disqus_thread></div><script type=text/javascript>(function(){if(window.location.hostname=="localhost")return;var e=document.createElement("script");e.async=!0,e.type="text/javascript",e.src="//definit.disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)})()</script><noscript>Please enable JavaScript to view the <a href=http://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><div class="clarity-prev-next col-xs-12 col-sm-12 col-md-12 col-lg-12"><nav class=clarity-page-prev-next><div class=clr-nav-previous><a href=https://www.definit.co.uk/2020/09/whats-in-your-kubernetes-home-lab/ title="What's in your Kubernetes Home Lab?" class="btn btn-sm btn-outline">Previous</a></div><div class=clr-nav-next><a href=https://www.definit.co.uk/2020/11/code-stream-custom-integration-generate-basic-authentication-header/ title="Code Stream - Custom Integration - Generate Basic Authentication Header" class="btn btn-sm btn-outline">Next</a></div></nav></div></div></div><script async src="https://www.googletagmanager.com/gtag/js?id=UA-4368767-1"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-4368767-1")</script><script src=/js/lightbox-plus-jquery.min.js></script></div></body></html>